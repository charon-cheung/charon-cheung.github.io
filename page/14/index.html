<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>Hexo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="Hexo">
<meta property="og:url" content="http://example.com/page/14/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="Hexo" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Hexo</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://example.com"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-ROS/ROS Kinetic知识/动态调整机制" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/11/15/ROS/ROS%20Kinetic%E7%9F%A5%E8%AF%86/%E5%8A%A8%E6%80%81%E8%B0%83%E6%95%B4%E6%9C%BA%E5%88%B6/" class="article-date">
  <time class="dt-published" datetime="2020-11-15T11:54:48.000Z" itemprop="datePublished">2020-11-15</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/ROS/">ROS</a>►<a class="article-category-link" href="/categories/ROS/ROS-Kinetic%E7%9F%A5%E8%AF%86/">ROS Kinetic知识</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/11/15/ROS/ROS%20Kinetic%E7%9F%A5%E8%AF%86/%E5%8A%A8%E6%80%81%E8%B0%83%E6%95%B4%E6%9C%BA%E5%88%B6/">动态调整机制</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p><code>params.cfg</code>文件</p>
<figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"></span><br><span class="line">PACKAGE = <span class="string">&quot;yocs_velocity_smoother&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> dynamic_reconfigure.parameter_generator_catkin <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">gen = ParameterGenerator()</span><br><span class="line"></span><br><span class="line">gen.add(<span class="string">&quot;speed_lim_v&quot;</span>, double_t, <span class="number">0</span>, <span class="string">&quot;Maximum linear velocity&quot;</span>, <span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">100.0</span>)</span><br><span class="line">gen.add(<span class="string">&quot;speed_lim_w&quot;</span>, double_t, <span class="number">0</span>, <span class="string">&quot;Maximum angular velocity&quot;</span>, <span class="number">5.0</span>, <span class="number">0.0</span>, <span class="number">100.0</span>)</span><br><span class="line">gen.add(<span class="string">&quot;accel_lim_v&quot;</span>, double_t, <span class="number">0</span>,</span><br><span class="line">        <span class="string">&quot;Maximum linear acceleration&quot;</span>, <span class="number">0.5</span>, <span class="number">0.0</span>, <span class="number">100.0</span>)</span><br><span class="line">gen.add(<span class="string">&quot;accel_lim_w&quot;</span>, double_t, <span class="number">0</span>,</span><br><span class="line">        <span class="string">&quot;Maximum angular acceleration&quot;</span>, <span class="number">2.5</span>, <span class="number">0.0</span>, <span class="number">100.0</span>)</span><br><span class="line">gen.add(<span class="string">&quot;decel_factor&quot;</span>, double_t, <span class="number">0</span>,</span><br><span class="line">        <span class="string">&quot;Deceleration to acceleration ratio&quot;</span>, <span class="number">1.0</span>, <span class="number">0.0</span>, <span class="number">10.0</span>)</span><br><span class="line"><span class="comment"># Second arg is node name it will run in (doc purposes only), third is generated filename prefix</span></span><br><span class="line">exit(gen.generate(PACKAGE, <span class="string">&quot;velocity_smoother_configure&quot;</span>, <span class="string">&quot;params&quot;</span>))</span><br></pre></td></tr></table></figure>
<p>这是一个基于python的模块，首先创建一个ParameterGenerator对象，然后调用其add()函数将参数添加到参数列表中。add()的参数含义分别是：参数名，参数类型，级别，描述，缺省值，最小值，最大值。</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/11/15/ROS/ROS%20Kinetic%E7%9F%A5%E8%AF%86/%E5%8A%A8%E6%80%81%E8%B0%83%E6%95%B4%E6%9C%BA%E5%88%B6/" data-id="ckr29myoz00c1i0lmhphofeal" data-title="动态调整机制" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-路径规划/大轮廓机器人的导航/(一) 轮廓的设置和切换" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/11/12/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92/%E5%A4%A7%E8%BD%AE%E5%BB%93%E6%9C%BA%E5%99%A8%E4%BA%BA%E7%9A%84%E5%AF%BC%E8%88%AA/(%E4%B8%80)%20%E8%BD%AE%E5%BB%93%E7%9A%84%E8%AE%BE%E7%BD%AE%E5%92%8C%E5%88%87%E6%8D%A2/" class="article-date">
  <time class="dt-published" datetime="2020-11-12T13:23:55.000Z" itemprop="datePublished">2020-11-12</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92/">路径规划</a>►<a class="article-category-link" href="/categories/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92/%E5%A4%A7%E8%BD%AE%E5%BB%93%E6%9C%BA%E5%99%A8%E4%BA%BA%E7%9A%84%E5%AF%BC%E8%88%AA/">大轮廓机器人的导航</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/11/12/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92/%E5%A4%A7%E8%BD%AE%E5%BB%93%E6%9C%BA%E5%99%A8%E4%BA%BA%E7%9A%84%E5%AF%BC%E8%88%AA/(%E4%B8%80)%20%E8%BD%AE%E5%BB%93%E7%9A%84%E8%AE%BE%E7%BD%AE%E5%92%8C%E5%88%87%E6%8D%A2/">(一) 轮廓的设置和切换</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>机器人装载大货架后的轮廓如下，大货架其实就是个箱子，投影到轮廓上是矩形<br><img src="https://i.loli.net/2021/06/02/4yLBqFlwMhVigOP.png" alt="机器人轮廓"><br>放到代价地图里，可以求出机器人的外接圆半径为0.65m，注意机器人的旋转中心永远是yaml里定义的<code>(0, 0)</code>，也就是这里的圆心。</p>
<p>现实作业中，给机器人换货架后，需要调度端切换机器人轮廓，发如下命令:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 原始底盘</span></span><br><span class="line">rostopic pub -1 /move_base/local_costmap/footprint_radius std_msgs/Float32 <span class="string">&#x27;0.26&#x27;</span></span><br><span class="line">rostopic pub -1 /move_base/global_costmap/footprint_radius std_msgs/Float32 <span class="string">&#x27;0.26&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 大货架</span></span><br><span class="line">rostopic pub -1 /move_base/local_costmap/polygon_footprint geometry_msgs/Polygon <span class="string">&#x27;[ [0.23,0.055], [0.14,0.235], [-0.61,0.235], [-0.61,-0.235], [0.14,-0.235], [0.23,-0.055] ]&#x27;</span></span><br><span class="line"></span><br><span class="line">rostopic pub -1 /move_base/global_costmap/polygon_footprint geometry_msgs/Polygon <span class="string">&#x27;[ [0.23,0.055], [0.14,0.235], [-0.61,0.235], [-0.61,-0.235], [0.14,-0.235], [0.23,-0.055] ]&#x27;</span></span><br></pre></td></tr></table></figure>



<p>在TEB中，由于是动态轮廓，对<code>min_obstacle_dist</code>要做不同处理：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(cfg_.robot.is_footprint_dynamic)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="comment">// Update footprint of the robot and minimum and maximum distance </span></span><br><span class="line">    <span class="comment">// from the center of the robot to its footprint vertices.</span></span><br><span class="line">    footprint_spec_ = costmap_ros_-&gt;<span class="built_in">getRobotFootprint</span>();</span><br><span class="line">    costmap_2d::<span class="built_in">calculateMinAndMaxDistances</span>(footprint_spec_, robot_inscribed_radius_, robot_circumscribed_radius);</span><br><span class="line">    <span class="keyword">if</span>( robot_circumscribed_radius / robot_inscribed_radius_ &lt; <span class="number">1.02</span> ) <span class="comment">// 圆形底盘</span></span><br><span class="line">        cfg_.obstacles.min_obstacle_dist = robot_inscribed_radius_;  <span class="comment">// fit dynamic footprint</span></span><br><span class="line"></span><br><span class="line">    cfg_.robot.robot_inscribed_radius =  robot_inscribed_radius_;</span><br><span class="line">    cfg_.robot.robot_circumscribed_radius = robot_circumscribed_radius;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/11/12/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92/%E5%A4%A7%E8%BD%AE%E5%BB%93%E6%9C%BA%E5%99%A8%E4%BA%BA%E7%9A%84%E5%AF%BC%E8%88%AA/(%E4%B8%80)%20%E8%BD%AE%E5%BB%93%E7%9A%84%E8%AE%BE%E7%BD%AE%E5%92%8C%E5%88%87%E6%8D%A2/" data-id="ckr29mysn00lzi0lm551i19lh" data-title="(一) 轮廓的设置和切换" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-C++/C++  基础/编程技巧" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/11/09/C++/C++%20%20%E5%9F%BA%E7%A1%80/%E7%BC%96%E7%A8%8B%E6%8A%80%E5%B7%A7/" class="article-date">
  <time class="dt-published" datetime="2020-11-09T12:40:04.000Z" itemprop="datePublished">2020-11-09</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/C/">C++</a>►<a class="article-category-link" href="/categories/C/C-%E5%9F%BA%E7%A1%80/">C++ 基础</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/11/09/C++/C++%20%20%E5%9F%BA%E7%A1%80/%E7%BC%96%E7%A8%8B%E6%8A%80%E5%B7%A7/">编程技巧</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="生成27个三维向量，每个可取-1-0-1，一共27种组合"><a href="#生成27个三维向量，每个可取-1-0-1，一共27种组合" class="headerlink" title="生成27个三维向量，每个可取-1,0,1，一共27种组合"></a>生成27个三维向量，每个可取-1,0,1，一共27种组合</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; <span class="number">3</span> * <span class="number">3</span> * <span class="number">3</span>; i++)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="keyword">int</span> a = (i / <span class="number">9</span>) - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> b = ((i % <span class="number">9</span>) / <span class="number">3</span>) - <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> c = ((i % <span class="number">9</span>) % <span class="number">3</span>) - <span class="number">1</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="在终端显示带颜色和风格的文字"><a href="#在终端显示带颜色和风格的文字" class="headerlink" title="在终端显示带颜色和风格的文字"></a>在终端显示带颜色和风格的文字</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// color指定颜色BLACK, RED, GREEN, YELLOW, BLUE, WHITE, option指定文字风格BOLD, REGULAR, UNDERLINE.</span></span><br><span class="line"><span class="keyword">const</span> std::string RESET = <span class="string">&quot;\033[0m&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> std::string BLACK = <span class="string">&quot;0m&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> std::string RED = <span class="string">&quot;1m&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> std::string GREEN = <span class="string">&quot;2m&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> std::string YELLOW = <span class="string">&quot;3m&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> std::string BLUE = <span class="string">&quot;4m&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> std::string WHITE = <span class="string">&quot;7m&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> std::string BOLD = <span class="string">&quot;\033[1;3&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> std::string REGULAR = <span class="string">&quot;\033[0;3&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> std::string UNDERLINE = <span class="string">&quot;\033[4;3&quot;</span>;</span><br><span class="line"><span class="keyword">const</span> std::string BACKGROUND = <span class="string">&quot;\033[4&quot;</span>;</span><br><span class="line"></span><br><span class="line"><span class="function">std::string <span class="title">colouredString</span><span class="params">(std::string str, std::string colour, std::string option)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">double</span> time_now = ros::Time::<span class="built_in">now</span>().<span class="built_in">toSec</span>();</span><br><span class="line">  std::string time_string = std::<span class="built_in">to_string</span>(time_now);</span><br><span class="line">  <span class="keyword">return</span> <span class="string">&quot;[&quot;</span> + time_string + <span class="string">&quot;]: &quot;</span> + option + colour + str + RESET;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="生成极值"><a href="#生成极值" class="headerlink" title="生成极值"></a>生成极值</h2><p>C++11中，std::numeric_limits为模板类，在库编译平台提供基础算术类型的极值等属性信息，取代传统C语言，所采用的预处理常数。比较常用的使用是对于给定的基础类型用来判断在当前系统上的最大值、最小值。需包含<limits>头文件。</p>
<p><code>std::numeric_limits&lt;double&gt;::max();</code>的结果是一个很大的数字</p>
<h2 id="数学函数"><a href="#数学函数" class="headerlink" title="数学函数"></a>数学函数</h2><ul>
<li><p><code>hypot()</code>用来求三角形的斜边长，其原型为：<code>double hypot(double x, double y);</code>，需要<code>#include &lt;stdio.h&gt;</code></p>
</li>
<li><p><code>fabs</code>函数是求绝对值的函数，函数原型是<code>extern float fabs(float x)</code>，需要<code>#include &lt;math.h&gt;</code></p>
</li>
</ul>
<p>对double/float数据，一定要使用fabs函数。如果用了abs，就会出现bug，因为返回也是int</p>
<h2 id="double-只取小数点后两位"><a href="#double-只取小数点后两位" class="headerlink" title="double 只取小数点后两位"></a>double 只取小数点后两位</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">double</span> d = <span class="number">0.2500000500001</span>;</span><br><span class="line"><span class="keyword">double</span> b = <span class="built_in">floor</span>(d * <span class="number">10000.000f</span> + <span class="number">0.5</span>) / <span class="number">10000.000f</span>;</span><br></pre></td></tr></table></figure>

<h2 id="反正切函数求角度"><a href="#反正切函数求角度" class="headerlink" title="反正切函数求角度"></a>反正切函数求角度</h2><p><code>atan2</code>返回给定的 X 及 Y 坐标值的反正切值。反正切的角度值等于 X 轴与通过原点和给定坐标点 (Y坐标, X坐标) 的直线之间的夹角。结果以弧度表示并介于<code>-pi</code>到<code>pi</code>之间（不包括<code>-pi</code>）。 </p>
<p>而<code>atan(a/b)</code>的取值范围介于<code>-pi/2</code>到<code>pi/2</code>之间，不包括±pi/2</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/11/09/C++/C++%20%20%E5%9F%BA%E7%A1%80/%E7%BC%96%E7%A8%8B%E6%8A%80%E5%B7%A7/" data-id="ckr29mynk008pi0lmgl5hfy99" data-title="编程技巧" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-ROS/ROS机器人/rqt_robot_steering" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/10/18/ROS/ROS%E6%9C%BA%E5%99%A8%E4%BA%BA/rqt_robot_steering/" class="article-date">
  <time class="dt-published" datetime="2020-10-18T06:34:26.000Z" itemprop="datePublished">2020-10-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/ROS/">ROS</a>►<a class="article-category-link" href="/categories/ROS/ROS%E6%9C%BA%E5%99%A8%E4%BA%BA/">ROS机器人</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/10/18/ROS/ROS%E6%9C%BA%E5%99%A8%E4%BA%BA/rqt_robot_steering/">rqt_robot_steering</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p><img src="https://i.loli.net/2020/10/14/mWBL6c7pu9nDjF4.png" alt="rqt_robot_steering"><br>一个带界面的节点，只要一启动，就不断发布<code>geometry_msgs/Twist</code>消息，调节滑条做配置</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/10/18/ROS/ROS%E6%9C%BA%E5%99%A8%E4%BA%BA/rqt_robot_steering/" data-id="ckr29mypk00dbi0lmcw3b32r6" data-title="rqt_robot_steering" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-视觉SLAM/从ROS配置realsense的参数" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/10/18/%E8%A7%86%E8%A7%89SLAM/%E4%BB%8EROS%E9%85%8D%E7%BD%AErealsense%E7%9A%84%E5%8F%82%E6%95%B0/" class="article-date">
  <time class="dt-published" datetime="2020-10-18T04:48:31.000Z" itemprop="datePublished">2020-10-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E8%A7%86%E8%A7%89SLAM/">视觉SLAM</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/10/18/%E8%A7%86%E8%A7%89SLAM/%E4%BB%8EROS%E9%85%8D%E7%BD%AErealsense%E7%9A%84%E5%8F%82%E6%95%B0/">从ROS配置realsense的参数</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="使用json配置realsense的参数-非rosparam"><a href="#使用json配置realsense的参数-非rosparam" class="headerlink" title="使用json配置realsense的参数(非rosparam)"></a>使用json配置realsense的参数(非rosparam)</h2><p>今天使用realsense时，发现有个参数需要修改<br><img src="https://i.loli.net/2020/10/15/lWn3xzM1CiyZtQX.png" alt="Set Point.png"><br>这个参数可以修正因反光而导致的错误，也就是把稍微凸起的地面当做障碍物，适当减小这个参数可以实现。</p>
<p>这个界面在realsense viewer中，但问题是如何在ROS中做到，它在rosparam中没有对应的参数。查来查去，在github的issue里发现了解决方法。realsense已经提供了一种<code>visual preset</code>文件，其实是个json文件，可以对很多参数设置，而且realsense的launch文件中已经定义了json文件的路径，比如<code>rs_camera.launch</code>:</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;json_file_path&quot;</span>      <span class="attr">default</span>=<span class="string">&quot;&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>realsense提供的所有json文件在<a target="_blank" rel="noopener" href="https://github.com/IntelRealSense/librealsense/wiki/D400-Series-Visual-Presets">这里</a>，我们需要的参数在<a target="_blank" rel="noopener" href="https://raw.githubusercontent.com/wiki/IntelRealSense/librealsense/d400_presets/DefaultPreset_D435.json">DefaultPreset_D435.json</a>，也就是第一个参数：<code>&quot;aux-param-autoexposure-setpoint&quot;: &quot;400&quot; </code>，修改它的值后，把json文件的路径填到上面launch参数那里，启动launch就可以实现了。不过不能动态调整参数。</p>
<h2 id="配置点云的滤波器"><a href="#配置点云的滤波器" class="headerlink" title="配置点云的滤波器"></a>配置点云的滤波器</h2><p><code>rs_camera.launch</code>的参数是比较全的，<code>demo_pointcloud.launch</code>比较少。</p>
<p>现在介绍<code>filters</code>这个参数，在launch中没有赋值:<code>&lt;arg name=&quot;filters&quot;  default=&quot;&quot;/&gt;</code></p>
<p>pointcloud: 点云话题是<code>/camera/depth/color/points</code>. 点云的texture可以在<code>rqt_reconfigure</code>里修改，或者用参数<code>pointcloud_texture_stream</code>和<code>pointcloud_texture_index</code>修改</p>
<p>The depth FOV and the texture FOV are not similar. By default, pointcloud is limited to the section of depth containing the texture. You can have a full depth to pointcloud, coloring the regions beyond the texture with zeros, by setting allow_no_texture_points to true.</p>
<p>可以配置的滤波器如下:</p>
<ul>
<li>disparity, convert depth to disparity before applying other filters and back.</li>
<li>spatial，filter the depth image spatially.</li>
<li>temporal，filter the depth image temporally.</li>
<li>hole_filling，apply hole-filling filter.</li>
<li>decimation，reduces depth scene complexity.</li>
</ul>
<p>所有滤波器的说明在<a target="_blank" rel="noopener" href="https://github.com/IntelRealSense/librealsense/blob/master/doc/post-processing-filters.md">这里</a></p>
<p>给参数<code>filters</code>赋值，必须有<code>pointcloud</code>，再增加滤波器，用逗号隔开。比如 <code>disparity,spatial,pointcloud</code></p>
<p>滤波器的相关的源码在<code>base_realsense_node.cpp</code></p>
<ul>
<li><p><code>BaseRealSenseNode::setupFilters()</code>, 读取参数<code>filters</code>，把所有滤波器名称都插入容器<code>_filters</code></p>
</li>
<li><p><code>BaseRealSenseNode::publishPointCloud()</code>, 发布滤波后的点云</p>
</li>
</ul>
<p>参考:<br><a target="_blank" rel="noopener" href="https://github.com/IntelRealSense/realsense-ros">realsense-ros 滤波器</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/Dontla/article/details/103574458">CSDN Realsense D435 Post-processing filters</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/10/18/%E8%A7%86%E8%A7%89SLAM/%E4%BB%8EROS%E9%85%8D%E7%BD%AErealsense%E7%9A%84%E5%8F%82%E6%95%B0/" data-id="ckr29mym8005wi0lm921d8qkb" data-title="从ROS配置realsense的参数" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-ROS/ROS Kinetic知识/ROS版本不兼容产生的TransformListenerWrapper问题" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/10/18/ROS/ROS%20Kinetic%E7%9F%A5%E8%AF%86/ROS%E7%89%88%E6%9C%AC%E4%B8%8D%E5%85%BC%E5%AE%B9%E4%BA%A7%E7%94%9F%E7%9A%84TransformListenerWrapper%E9%97%AE%E9%A2%98/" class="article-date">
  <time class="dt-published" datetime="2020-10-18T04:30:32.000Z" itemprop="datePublished">2020-10-18</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/ROS/">ROS</a>►<a class="article-category-link" href="/categories/ROS/ROS-Kinetic%E7%9F%A5%E8%AF%86/">ROS Kinetic知识</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/10/18/ROS/ROS%20Kinetic%E7%9F%A5%E8%AF%86/ROS%E7%89%88%E6%9C%AC%E4%B8%8D%E5%85%BC%E5%AE%B9%E4%BA%A7%E7%94%9F%E7%9A%84TransformListenerWrapper%E9%97%AE%E9%A2%98/">tf的疑难问题</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="ROS版本不兼容产生的TransformListenerWrapper问题"><a href="#ROS版本不兼容产生的TransformListenerWrapper问题" class="headerlink" title="ROS版本不兼容产生的TransformListenerWrapper问题"></a>ROS版本不兼容产生的TransformListenerWrapper问题</h2><p><code>AmclNode</code>类中有这样一段：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Use a child class to get access to tf2::Buffer class inside of tf_</span></span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">TransformListenerWrapper</span> :</span> <span class="keyword">public</span> tf::TransformListener</span><br><span class="line">&#123;</span><br><span class="line">   <span class="function"><span class="keyword">inline</span> tf2_ros::Buffer &amp;<span class="title">getBuffer</span><span class="params">()</span> </span>&#123;<span class="keyword">return</span> tf2_buffer_;&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p>这是Kinetic的版本，但是在Melodic里没有这一段了，这是ROS版本兼容问题，在Kinetic里用不了这个结构体了。搜索发现<code>getBuffer</code>只有在<code>AmclNode::runFromBag</code>里调用，因为平时不用bag仿真时测试AMCL，所以这句话可以注释掉。</p>
<h2 id="“map”-passed-to-lookupTransform-argument-target-frame-does-not-exist"><a href="#“map”-passed-to-lookupTransform-argument-target-frame-does-not-exist" class="headerlink" title="“map” passed to lookupTransform argument target_frame does not exist"></a>“map” passed to lookupTransform argument target_frame does not exist</h2><p>解决方法： 先加上<code>listener.waitForTransform</code>，再<code>lookupTransform</code></p>
<p>The listener’s buffer, which carries all information about recent transformation, is literally empty. Therefore, any transform which looks-up the buffer does not find the frames it needs. It is good practice to wait for some time after the listener has been created so that the buffer can fill up. But instead of just sleeping, tf use <code>waitForTransform</code></p>
<p>参考: <a target="_blank" rel="noopener" href="https://answers.ros.org/question/192570/tftransformlistenertransformpose-exception-target_frame-does-not-exist/"></a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/10/18/ROS/ROS%20Kinetic%E7%9F%A5%E8%AF%86/ROS%E7%89%88%E6%9C%AC%E4%B8%8D%E5%85%BC%E5%AE%B9%E4%BA%A7%E7%94%9F%E7%9A%84TransformListenerWrapper%E9%97%AE%E9%A2%98/" data-id="ckr29myoq00bei0lm223a9sf5" data-title="tf的疑难问题" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-激光SLAM/ICP/csm包的源码解读 (二)" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/09/25/%E6%BF%80%E5%85%89SLAM/ICP/csm%E5%8C%85%E7%9A%84%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB%20(%E4%BA%8C)/" class="article-date">
  <time class="dt-published" datetime="2020-09-25T14:08:00.000Z" itemprop="datePublished">2020-09-25</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%BF%80%E5%85%89SLAM/">激光SLAM</a>►<a class="article-category-link" href="/categories/%E6%BF%80%E5%85%89SLAM/ICP/">ICP</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/09/25/%E6%BF%80%E5%85%89SLAM/ICP/csm%E5%8C%85%E7%9A%84%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB%20(%E4%BA%8C)/">csm包的源码解读 (二)</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p><img src="https://i.loli.net/2020/09/25/6sJwMcTGiyY9Ztb.png" alt="smart algorithm.png"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/09/25/%E6%BF%80%E5%85%89SLAM/ICP/csm%E5%8C%85%E7%9A%84%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB%20(%E4%BA%8C)/" data-id="ckr29myql00fpi0lm3qnodx2q" data-title="csm包的源码解读 (二)" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-激光SLAM/Cartographer/源码解读/(七) 处理里程计和IMU数据的流程" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/09/21/%E6%BF%80%E5%85%89SLAM/Cartographer/%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB/(%E4%B8%83)%20%E5%A4%84%E7%90%86%E9%87%8C%E7%A8%8B%E8%AE%A1%E5%92%8CIMU%E6%95%B0%E6%8D%AE%E7%9A%84%E6%B5%81%E7%A8%8B/" class="article-date">
  <time class="dt-published" datetime="2020-09-21T09:12:19.000Z" itemprop="datePublished">2020-09-21</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%BF%80%E5%85%89SLAM/">激光SLAM</a>►<a class="article-category-link" href="/categories/%E6%BF%80%E5%85%89SLAM/Cartographer/">Cartographer</a>►<a class="article-category-link" href="/categories/%E6%BF%80%E5%85%89SLAM/Cartographer/%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB/">源码解读</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/09/21/%E6%BF%80%E5%85%89SLAM/Cartographer/%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB/(%E4%B8%83)%20%E5%A4%84%E7%90%86%E9%87%8C%E7%A8%8B%E8%AE%A1%E5%92%8CIMU%E6%95%B0%E6%8D%AE%E7%9A%84%E6%B5%81%E7%A8%8B/">(七) 处理里程计和IMU数据的流程</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p><img src="https://i.loli.net/2020/09/21/rGYzJWLIel85FMw.png" alt="处理里程计数据的流程.png"></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/09/21/%E6%BF%80%E5%85%89SLAM/Cartographer/%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB/(%E4%B8%83)%20%E5%A4%84%E7%90%86%E9%87%8C%E7%A8%8B%E8%AE%A1%E5%92%8CIMU%E6%95%B0%E6%8D%AE%E7%9A%84%E6%B5%81%E7%A8%8B/" data-id="ckr29myt000mvi0lm0uic25qi" data-title="(七) 处理里程计和IMU数据的流程" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-数学基础/坐标系空间转换" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/09/20/%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80/%E5%9D%90%E6%A0%87%E7%B3%BB%E7%A9%BA%E9%97%B4%E8%BD%AC%E6%8D%A2/" class="article-date">
  <time class="dt-published" datetime="2020-09-20T12:00:16.000Z" itemprop="datePublished">2020-09-20</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80/">数学基础</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/09/20/%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80/%E5%9D%90%E6%A0%87%E7%B3%BB%E7%A9%BA%E9%97%B4%E8%BD%AC%E6%8D%A2/">坐标系空间转换</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="Censi-公式"><a href="#Censi-公式" class="headerlink" title="Censi 公式"></a>Censi 公式</h2><p><img src="https://i.loli.net/2020/09/20/hsubLed7priFZmS.jpg" alt="坐标系示意图.jpg"><br><img src="https://i.loli.net/2020/09/20/YzpFTi8yEwqHhf5.jpg" alt="圆加和圆减.jpg"><br><img src="https://i.loli.net/2020/09/20/WbSvxUlGwCHNzgF.png"><br><img src="https://i.loli.net/2021/04/28/sbLxYg1oUdRaNkT.jpg"></p>
<p>左乘是行变换，右乘是列变换。这是因为习惯上来说，空间中的向量用列向量表示，用矩阵左乘列向量，就是把它在空间当中变换。</p>
<p>若绕静坐标系（世界坐标系）旋转，则左乘，也是<strong>变换矩阵 X 坐标矩阵</strong></p>
<p>若是绕动坐标系旋转（自身建立一个坐标系），则右乘，也就是<strong>坐标矩阵 X 变换矩阵</strong>。 </p>
<p>即左乘是相对于坐标值所在的坐标系（世界坐标系）下的三个坐标轴进行旋转变换，右乘则是以当前点为旋转中心，进行旋转变换。</p>
<p><a target="_blank" rel="noopener" href="https://www.pianshen.com/article/17351558785/">cartographer中公式的推导</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/09/20/%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80/%E5%9D%90%E6%A0%87%E7%B3%BB%E7%A9%BA%E9%97%B4%E8%BD%AC%E6%8D%A2/" data-id="ckr29mylk004ai0lm2u5phnqp" data-title="坐标系空间转换" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-激光SLAM/ICP/laser_scan_matcher 源码解读" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2020/09/19/%E6%BF%80%E5%85%89SLAM/ICP/laser_scan_matcher%20%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB/" class="article-date">
  <time class="dt-published" datetime="2020-09-19T13:44:12.000Z" itemprop="datePublished">2020-09-19</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/%E6%BF%80%E5%85%89SLAM/">激光SLAM</a>►<a class="article-category-link" href="/categories/%E6%BF%80%E5%85%89SLAM/ICP/">ICP</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2020/09/19/%E6%BF%80%E5%85%89SLAM/ICP/laser_scan_matcher%20%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB/">laser_scan_matcher 源码解读</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <p>主要是<code>LaserScanMatcher</code>的构造函数：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ros::<span class="built_in">init</span>(argc, argv, <span class="string">&quot;LaserScanMatcher&quot;</span>);</span><br><span class="line">ros::NodeHandle nh;</span><br><span class="line"><span class="function">ros::NodeHandle <span class="title">nh_private</span><span class="params">(<span class="string">&quot;~&quot;</span>)</span></span>;</span><br><span class="line"><span class="function">scan_tools::LaserScanMatcher <span class="title">laser_scan_matcher</span><span class="params">(nh, nh_private)</span></span>;</span><br><span class="line">ros::<span class="built_in">spin</span>();</span><br></pre></td></tr></table></figure>

<p>构造函数里初始化一系列参数，重点就是回调函数<code>scanCallback</code></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 第一帧scan, cache the tf from base to the scanner</span></span><br><span class="line"><span class="keyword">if</span> (!initialized_)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">createCache</span>(scan_msg);    <span class="comment">// caches the sin and cos of all angles</span></span><br><span class="line">  <span class="comment">// cache the static tf from base to laser</span></span><br><span class="line">  <span class="keyword">if</span> (!<span class="built_in">getBaseToLaserTf</span>(scan_msg-&gt;header.frame_id))</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">ROS_WARN</span>(<span class="string">&quot;Skipping scan&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// 保存scan数据到  LDP  prev_ldp_scan_;</span></span><br><span class="line">  <span class="built_in">laserScanToLDP</span>(scan_msg, prev_ldp_scan_);</span><br><span class="line">  last_icp_time_ = scan_msg-&gt;header.stamp;</span><br><span class="line">  initialized_ = <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 第二帧及以后的scan</span></span><br><span class="line">index++;		<span class="comment">// static unsigned int index;</span></span><br><span class="line"><span class="built_in">ROS_INFO</span>(<span class="string">&quot;scan index: %d&quot;</span>, index);</span><br><span class="line">LDP  curr_ldp_scan;</span><br><span class="line"><span class="built_in">laserScanToLDP</span>(scan_msg, curr_ldp_scan);</span><br><span class="line"><span class="built_in">processScan</span>(curr_ldp_scan, scan_msg-&gt;header.stamp);</span><br></pre></td></tr></table></figure>

<p><img src="https://i.loli.net/2020/09/20/VTNfbxGYmPqK3Li.png" alt="流程.png"></p>
<h2 id="公式计算"><a href="#公式计算" class="headerlink" title="公式计算"></a>公式计算</h2><h2 id="newKeyframeNeeded"><a href="#newKeyframeNeeded" class="headerlink" title="newKeyframeNeeded"></a>newKeyframeNeeded</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="built_in">fabs</span>(tf::<span class="built_in">getYaw</span>(d.<span class="built_in">getRotation</span>())) &gt; kf_dist_angular_)</span><br><span class="line">   <span class="keyword">return</span>   <span class="literal">true</span>;</span><br><span class="line"><span class="keyword">double</span> x = d.<span class="built_in">getOrigin</span>().<span class="built_in">getX</span>();</span><br><span class="line"><span class="keyword">double</span> y = d.<span class="built_in">getOrigin</span>().<span class="built_in">getY</span>();</span><br><span class="line"><span class="keyword">if</span> (x*x + y*y &gt; kf_dist_linear_sq_)</span><br><span class="line">   <span class="keyword">return</span>  <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> <span class="literal">false</span>;</span><br></pre></td></tr></table></figure>
<p>优先判断相对旋转</p>
<p>调用是这样：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 交换新旧frame, key frame 的意思应该是当前配准时的参考帧</span></span><br><span class="line"><span class="comment">// 这个在机器人一直走直线或原地旋转时很难发生</span></span><br><span class="line"><span class="keyword">if</span> (<span class="built_in">newKeyframeNeeded</span>(corr_ch))</span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">// generate  a  keyframe</span></span><br><span class="line">	<span class="built_in">ld_free</span>(prev_ldp_scan_);</span><br><span class="line">	prev_ldp_scan_ = curr_ldp_scan;</span><br><span class="line">	<span class="comment">// 更新下一个时间段的 f2b_kf</span></span><br><span class="line">	f2b_kf_ = f2b_;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>prev_ldp_scan_</code>之前是第一帧scan的数据，只有需要 key frame时，才会更新它，但在<code>processScan</code>开头又会把估计位姿和真值初始化为0。  如果没有达到运动阈值，<code>prev_ldp_scan_</code>还是第一帧scan，时间也是第一帧的时间，仍以第一帧为基准进行ICP配准</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://example.com/2020/09/19/%E6%BF%80%E5%85%89SLAM/ICP/laser_scan_matcher%20%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB/" data-id="ckr29myqm00fqi0lmfa6aanbh" data-title="laser_scan_matcher 源码解读" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <a class="extend prev" rel="prev" href="/page/13/">&laquo; Prev</a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/12/">12</a><a class="page-number" href="/page/13/">13</a><span class="page-number current">14</span><a class="page-number" href="/page/15/">15</a><a class="page-number" href="/page/16/">16</a><span class="space">&hellip;</span><a class="page-number" href="/page/44/">44</a><a class="extend next" rel="next" href="/page/15/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/C/">C++</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/C/Boost/">Boost</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/C/C-%E5%9F%BA%E7%A1%80/">C++ 基础</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/C/C-%E6%A8%A1%E6%9D%BF%E4%B8%8ESTL/">C++ 模板与STL</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/C/C-%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1/">C++ 面向对象</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/C/%E5%A4%9A%E7%BA%BF%E7%A8%8B/">多线程</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/Linux%E5%9F%BA%E7%A1%80/">Linux基础</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Matlab/">Matlab</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/PCL%E7%82%B9%E4%BA%91/">PCL点云</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/ROS/">ROS</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/ROS/ROS-Kinetic%E7%9F%A5%E8%AF%86/">ROS Kinetic知识</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/ROS/ROS%E6%9C%BA%E5%99%A8%E4%BA%BA/">ROS机器人</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/ROS/ROS%E7%A8%8B%E5%BA%8F%E5%92%8C%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90/">ROS程序和源码分析</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/ROS/rviz%E6%B7%B1%E5%85%A5%E7%A0%94%E7%A9%B6/">rviz深入研究</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/ROS/%E6%9C%BA%E5%99%A8%E4%BA%BA%E5%AF%BC%E8%88%AA/">机器人导航</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/SLAM%E5%B7%A5%E5%85%B7/">SLAM工具</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Valgrind%E5%92%8C%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/">Valgrind和内存管理</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/Wireshark/">Wireshark</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/cmake-qmake/">cmake/qmake</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%85%B6%E4%BB%96/">其他</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%8D%97%E4%BA%AC%E5%AF%BC%E8%88%AA%E7%A8%8B%E5%BA%8F%E7%9A%84%E7%96%91%E9%9A%BE%E9%97%AE%E9%A2%98/">南京导航程序的疑难问题</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7/">常用工具</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%95%B0%E5%AD%A6%E5%9F%BA%E7%A1%80/">数学基础</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%BF%80%E5%85%89SLAM/">激光SLAM</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%BF%80%E5%85%89SLAM/Cartographer/">Cartographer</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%BF%80%E5%85%89SLAM/Cartographer/%E5%8E%9F%E7%90%86%E5%92%8C%E9%85%8D%E7%BD%AE/">原理和配置</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%BF%80%E5%85%89SLAM/Cartographer/%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB/">源码解读</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%BF%80%E5%85%89SLAM/ICP/">ICP</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%BF%80%E5%85%89SLAM/amcl%E5%92%8C%E7%B2%92%E5%AD%90%E6%BB%A4%E6%B3%A2/">amcl和粒子滤波</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%BF%80%E5%85%89SLAM/gmapping/">gmapping</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%BF%80%E5%85%89SLAM/%E5%85%B6%E4%BB%96/">其他</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%BF%80%E5%85%89SLAM/%E5%8D%A1%E5%B0%94%E6%9B%BC%E6%BB%A4%E6%B3%A2/">卡尔曼滤波</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%BF%80%E5%85%89SLAM/%E5%8F%8D%E5%85%89%E6%9D%BF/">反光板</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%BF%80%E5%85%89SLAM/%E7%AE%97%E6%B3%95%E6%8E%A8%E5%AF%BC/">算法推导</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E6%BF%80%E5%85%89SLAM/%E9%9B%B7%E8%BE%BE/">雷达</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93/">第三方库</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%84%9A%E6%9C%AC/">脚本</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%A7%86%E8%A7%89SLAM/">视觉SLAM</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92/">路径规划</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92/TEB%E7%AE%97%E6%B3%95/">TEB算法</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92/TEB%E7%AE%97%E6%B3%95/costmap-converter/">costmap converter</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92/move-base%E5%88%86%E6%9E%90/">move_base分析</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92/%E4%BB%A3%E4%BB%B7%E5%9C%B0%E5%9B%BE/">代价地图</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92/%E5%85%A8%E5%B1%80%E8%B7%AF%E5%BE%84%E7%AE%97%E6%B3%95/">全局路径算法</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92/%E5%85%B6%E4%BB%96/">其他</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92/%E5%9F%BA%E4%BA%8Erealsense%E6%89%AB%E6%8F%8F%E7%82%B9%E4%BA%91%E7%9A%84%E4%BD%8E%E7%9F%AE%E9%81%BF%E9%9A%9C/">基于realsense扫描点云的低矮避障</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92/%E5%A4%A7%E8%BD%AE%E5%BB%93%E6%9C%BA%E5%99%A8%E4%BA%BA%E7%9A%84%E5%AF%BC%E8%88%AA/">大轮廓机器人的导航</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/%E9%9D%A2%E8%AF%95%E7%AC%94%E8%AF%95/">面试笔试</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/web%E6%9C%8D%E5%8A%A1%E5%99%A8/" rel="tag">web服务器</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/" rel="tag">内存管理</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E6%91%84%E5%83%8F%E5%A4%B4/" rel="tag">摄像头</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E7%BC%96%E8%AF%91%E8%B0%83%E8%AF%95/" rel="tag">编译调试</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/%E9%9D%A2%E8%AF%95%E7%AC%94%E8%AF%95/" rel="tag">面试笔试</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/web%E6%9C%8D%E5%8A%A1%E5%99%A8/" style="font-size: 10px;">web服务器</a> <a href="/tags/%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/" style="font-size: 10px;">内存管理</a> <a href="/tags/%E6%91%84%E5%83%8F%E5%A4%B4/" style="font-size: 15px;">摄像头</a> <a href="/tags/%E7%BC%96%E8%AF%91%E8%B0%83%E8%AF%95/" style="font-size: 20px;">编译调试</a> <a href="/tags/%E9%9D%A2%E8%AF%95%E7%AC%94%E8%AF%95/" style="font-size: 10px;">面试笔试</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/07/">July 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/06/">June 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/05/">May 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/04/">April 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/03/">March 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/02/">February 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2021/01/">January 2021</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/12/">December 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/11/">November 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/10/">October 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/09/">September 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/08/">August 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/07/">July 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/06/">June 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/05/">May 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/03/">March 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/02/">February 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/12/">December 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/11/">November 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/10/">October 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/09/">September 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/08/">August 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/07/">July 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/06/">June 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/05/">May 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/04/">April 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/03/">March 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/02/">February 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2019/01/">January 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/12/">December 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/11/">November 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/10/">October 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/09/">September 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/08/">August 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/07/">July 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/05/">May 2018</a></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2018/04/">April 2018</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2021/07/13/%E6%BF%80%E5%85%89SLAM/%E7%AE%97%E6%B3%95%E6%8E%A8%E5%AF%BC/%E9%AB%98%E6%96%AF%E7%89%9B%E9%A1%BF%E6%B3%95/">高斯牛顿法</a>
          </li>
        
          <li>
            <a href="/2021/07/13/%E6%BF%80%E5%85%89SLAM/%E7%AE%97%E6%B3%95%E6%8E%A8%E5%AF%BC/%E7%89%9B%E9%A1%BF%E6%B3%95/">牛顿法</a>
          </li>
        
          <li>
            <a href="/2021/07/12/%E7%AC%94%E8%AF%95%E9%9D%A2%E8%AF%95/ROS/">ROS</a>
          </li>
        
          <li>
            <a href="/2021/07/12/%E7%AC%94%E8%AF%95%E9%9D%A2%E8%AF%95/%E7%AE%97%E6%B3%95/">算法</a>
          </li>
        
          <li>
            <a href="/2021/07/07/%E6%BF%80%E5%85%89SLAM/Cartographer/%E6%BA%90%E7%A0%81%E8%A7%A3%E8%AF%BB/AddAccumulatedRangeData%E5%87%BD%E6%95%B0(3)/">AddAccumulatedRangeData函数(3) 加入位姿估计器和插入子图</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2021 John Doe<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>