<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content=""><meta name="keywords" content=""><meta name="author" content="Charon Cheung"><meta name="copyright" content="Charon Cheung"><title>If you wish for peace, prepare for war | 沉默杀手</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.6.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.6.1"><link rel="dns-prefetch" href="https://cdn.staticfile.org"><link rel="dns-prefetch" href="https://cdn.bootcss.com"><link rel="dns-prefetch" href="https://creativecommons.org"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  }
} </script><meta name="generator" content="Hexo 5.4.0"></head><body><canvas class="fireworks"></canvas><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar"><div class="author-info"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">Charon Cheung</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">457</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">5</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">41</span></a></div></div></div><nav id="nav" style="background-image: url(https://i.loli.net/2021/07/13/RCLw5Bx8aFPN74b.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">沉默杀手</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus"><a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span></div><div id="site-info"><div id="site-title">沉默杀手</div><div id="site-sub-title">If you wish for peace, prepare for war</div></div></nav><div id="content-outer"><div class="layout" id="content-inner"><div class="recent-post-item article-container"><a class="article-title" href="/2021/11/04/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92/%E4%BB%A3%E4%BB%B7%E5%9C%B0%E5%9B%BE/%E9%9A%9C%E7%A2%8D%E5%B1%824%20%20%E4%BB%8E%E4%BB%A3%E4%BB%B7%E5%9C%B0%E5%9B%BE%E6%B8%85%E9%99%A4%E9%9A%9C%E7%A2%8D/">障碍层4  从代价地图清除障碍</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-11-04</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92/">路径规划</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92/%E4%BB%A3%E4%BB%B7%E5%9C%B0%E5%9B%BE/">代价地图</a></span><div class="content"><p><code>Costmap2DROS::mapUpdateLoop</code> —— <code>Costmap2DROS::updateMap()</code> —— <code>LayeredCostmap::updateMap</code>—— 每一层的 <code>updateBounds</code></p>
<h2 id="updateBounds"><a href="#updateBounds" class="headerlink" title="updateBounds"></a>updateBounds</h2><p>更新障碍地图边界，这个函数主要完成 clearing, marking以及确定bound。</p>
<p>和静态地图类似，同样也是先判断是否是rolling地图，若是则更新地图原点。</p>
<h3 id="raytraceFreespace"><a href="#raytraceFreespace" class="headerlink" title="raytraceFreespace"></a>raytraceFreespace</h3><p>清理传感器到障碍物间的cell，会首先处理测量值越界的问题，然后调用<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">MarkCell <span class="title">marker</span><span class="params">(costmap_, FREE_SPACE)</span></span>;</span><br><span class="line"><span class="comment">// and finally... we can execute our trace to clear obstacles along that line</span></span><br><span class="line"><span class="built_in">raytraceLine</span>(marker, x0, y0, x1, y1, cell_raytrace_range);</span><br><span class="line"><span class="built_in">updateRaytraceBounds</span>(ox, oy, wx, wy, clearing_observation.raytrace_range_, min_x, min_y, max_x, max_y);</span><br></pre></td></tr></table></figure><br>最终raytraceLine(marker, x0, y0, x1, y1, cell_raytrace_range); 会将所有在(x0,y0)&gt;&gt;(x1,y1)之间的所有cell标记为FREE_SPACE。而updateRaytraceBounds 会根据测量的距离，更新扩张（min_x, min_y, max_x, max_y）。<br>updateBounds 在根据测量数据完成clear 操作之后，就开始了mark 操作，对每个测量到的点，标记为obstacle ：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">double</span> px = cloud.points[i].x, py = cloud.points[i].y, pz = cloud.points[i].z;</span><br><span class="line"></span><br><span class="line">......省略</span><br><span class="line"></span><br><span class="line"><span class="keyword">unsigned</span> <span class="keyword">int</span> index = <span class="built_in">getIndex</span>(mx, my);</span><br><span class="line">costmap_[index] = LETHAL_OBSTACLE;</span><br><span class="line"><span class="built_in">touch</span>(px, py, min_x, min_y, max_x, max_y);</span><br></pre></td></tr></table></figure></p>
<p><img src="https://i.loli.net/2021/07/14/s2UD3i8wOE4zPCo.png" alt=""></p>
<p><code>Observation</code> Stores an observation in terms of a point cloud and the origin of the source</p>
<ul>
<li><code>geometry_msgs::Point origin_;</code>   The origin point of the observation</li>
<li><code>pcl::PointCloud&lt;pcl::PointXYZ&gt;* cloud_;</code>   point cloud of the observation</li>
<li><code>double obstacle_range_;</code>  The range out to which an observation should be able to insert obstacles</li>
<li><code>double raytrace_range_;</code>  The range out to which an observation should be able to clear via raytracing</li>
</ul>
<h2 id="updateCosts"><a href="#updateCosts" class="headerlink" title="updateCosts"></a>updateCosts</h2><p>更新障碍地图代价，将机器人足迹范围内设置为<code>FREE_SPACE</code>，并且在bound范围内将本层障碍地图的内容合并到主地图上。</p>
<p>障碍物层是将传感器检测到的点云投影到地图中，不同的传感器来源会分别存到Observation类中。只要遍历存储Obsrvation的容器，将检测到的点云的每个点分别投影到地图中，将对应的网格的代价值设为LETHAL_OBSTACLE，其实现函数在void ObstacleLayer::updateBounds(…)中：</p>
<p>清除代价地图的方式也很好理解，以单线激光雷达的激光线为例子，当激光线发射出去之后，在某处检测到一个障碍物，那说明：从发射的地方至某处之间是free的，那么这之间的旧的障碍物应当被删除，这之间网格的代价值应当被修改为free</p>
<p>可能是Bresenham2D的round off error(舍入误差)造成的. It marks a particular cell as obstacle but the next time when the sensor reading changes instantaneously, it no longer traces it through the same path and hence, the blob seem remains in the costmap.</p>
<p>added 2 lines of code to the Bresenham2D algorithm. This basically clears the cell to the left and right of the grid through which the Line segment constructed by the algorithm passes. This results in loosing some resolution of the map, but the solution works pretty well in real life application</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// A 2D implementation of Bresenham&#x27;s raytracing algorithm, applies an action </span></span><br><span class="line"><span class="comment">// at each step template&lt;class ActionType&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">bresenham2D</span><span class="params">( ActionType at, <span class="keyword">unsigned</span> <span class="keyword">int</span> abs_da, <span class="keyword">unsigned</span> <span class="keyword">int</span> abs_db, </span></span></span><br><span class="line"><span class="params"><span class="function">                        <span class="keyword">int</span> error_b, <span class="keyword">int</span> offset_a, <span class="keyword">int</span> offset_b, <span class="keyword">unsigned</span> <span class="keyword">int</span> offset, </span></span></span><br><span class="line"><span class="params"><span class="function">                        <span class="keyword">unsigned</span> <span class="keyword">int</span> max_length)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> end = std::<span class="built_in">min</span>(max_length, abs_da);</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">unsigned</span> <span class="keyword">int</span> i = <span class="number">0</span>; i &lt; end; ++i)</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">at</span>(offset);</span><br><span class="line">    <span class="built_in">at</span>(offset+<span class="number">1</span>); <span class="comment">// **ADDED THIS LINE**</span></span><br><span class="line">    <span class="built_in">at</span>(offset<span class="number">-1</span>); <span class="comment">// **ADDED THIS LINE**</span></span><br><span class="line">    offset += offset_a;</span><br><span class="line">    error_b += abs_db;</span><br><span class="line">    <span class="keyword">if</span> ((<span class="keyword">unsigned</span> <span class="keyword">int</span>)error_b &gt;= abs_da)</span><br><span class="line">    &#123;</span><br><span class="line">      offset += offset_b;</span><br><span class="line">      error_b -= abs_da;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">at</span>(offset);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/11/04/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92/%E4%BB%A3%E4%BB%B7%E5%9C%B0%E5%9B%BE/map_server%E5%8A%A0%E8%BD%BD%E4%B8%8D%E5%90%8C%E5%A4%A7%E5%B0%8F%E5%9C%B0%E5%9B%BE%E7%9A%84%E5%BD%B1%E5%93%8D/">map_server加载不同大小地图的影响</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-11-04</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92/">路径规划</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92/%E4%BB%A3%E4%BB%B7%E5%9C%B0%E5%9B%BE/">代价地图</a></span><div class="content"><h2 id="小地图"><a href="#小地图" class="headerlink" title="小地图"></a>小地图</h2><p>加载小地图，目标点出了地图范围时，导航会失败，<code>GlobalPlanner::makePlan</code>出现报警:</p>
<font color = orange size=4>The robot's start position is off the global costmap. Planning will always fail, are you sure the robot has been properly localized? </font>

<p>这很容易理解，除了地图就到不了了</p>
<h2 id="大地图"><a href="#大地图" class="headerlink" title="大地图"></a>大地图</h2><p>加载一个空的 20000x20000 的地图，转成pgm格式，高达380M。结果加载时会在<code>map_server::loadMapFromFile</code>里报错： <font color = red size = 4>  [ERROR] failed to open image file “/home/dxr/ws/src/follow/map/big_blank.pgm”: Out of memory
 </font></p>
<p>原理是map_server使用<code>SDL</code>加载地图文件，这就把问题下降到SDL了。ubuntu18所用SDL版本是1.2，原因在源码<code>SDL_surface.c</code>里对地图宽和高做了限制<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">SDL_Surface * <span class="title">SDL_CreateRGBSurface</span> <span class="params">(Uint32 flags,</span></span></span><br><span class="line"><span class="params"><span class="function">      <span class="keyword">int</span> width, <span class="keyword">int</span> height, <span class="keyword">int</span> depth,</span></span></span><br><span class="line"><span class="params"><span class="function">      Uint32 Rmask, Uint32 Gmask, Uint32 Bmask, Uint32 Amask)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">      ......</span><br><span class="line">  <span class="comment">/* Make sure the size requested doesn&#x27;t overflow our datatypes */</span></span><br><span class="line">  <span class="comment">/* Next time I write a library like SDL, I&#x27;ll use int for size. :) */</span></span><br><span class="line">  <span class="keyword">if</span> ( width &gt;= <span class="number">16384</span> || height &gt;= <span class="number">65536</span> ) &#123;</span><br><span class="line">    <span class="built_in">SDL_SetError</span>(<span class="string">&quot;Width or height is too large&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span>(<span class="literal">NULL</span>);</span><br><span class="line">  &#125;</span><br><span class="line">      ......</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>到这里其实不用再研究了，不用想怎么改善SDL了。有些公司的处理方法是每次只加载一部分地图，这也是3D稠密和稀疏重建常用的方法</p>
<p>其实就算这里通过了，到move_base创建代价地图时，new分配了太多内存，还有可能出错</p>
<h2 id="不加载地图"><a href="#不加载地图" class="headerlink" title="不加载地图"></a>不加载地图</h2><p>最令人想不到的是还可以不加载地图，使用里程计，但此时无法规划路径。把全局代价地图的参数改的跟局部代价地图一样，去掉静态层，但是增大<code>rolling_window</code>的大小，也就是说使用一大一小的局部代价地图，然后就可以规划路径了，相当于以前只用局部代价地图避障。这看上去冗余，而且浪费计算机性能。<br><img src="https://i.loli.net/2021/11/04/8sQTD96qcWpHtYv.png" alt=""><br>如果不用全局代价地图，启动不报错，还是无法规划路径。原因在于<code>move_base.cpp</code>里对全局和局部代价地图都使用了，除非将源码中的全局代价地图部分删除，不过影响太大了。</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/11/03/ROS/ROS%E6%9C%BA%E5%99%A8%E4%BA%BA/xsens%20IMU/">xsens IMU的使用</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-11-03</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/ROS/">ROS</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/ROS/ROS%E6%9C%BA%E5%99%A8%E4%BA%BA/">ROS机器人</a></span><div class="content"><p><code>roslaunch xsens_driver xsens_driver.launch</code></p>
<p>参考: </p>
<p><a target="_blank" rel="noopener" href="https://blog.csdn.net/weixin_41469272/article/details/107512032">基于ros melodic 及 MTI-G-710测试</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/LSG_Down/article/details/81068114">Xsens MTi -1 姿态传感器恢复与MTI的通信的方法</a></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/10/31/ROS/ROS%20Kinetic%E7%9F%A5%E8%AF%86/python%E4%B8%AD%E4%BD%BF%E7%94%A8ROS%E7%9A%84%E6%B3%A8%E6%84%8F%E7%82%B9/">python中使用ROS的注意点</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-10-31</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/ROS/">ROS</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/ROS/ROS-Kinetic%E7%9F%A5%E8%AF%86/">ROS Kinetic知识</a></span><div class="content"><h2 id="python2-7和python3的冲突问题"><a href="#python2-7和python3的冲突问题" class="headerlink" title="python2.7和python3的冲突问题"></a>python2.7和python3的冲突问题</h2><p>之前在<a href="">ROS安装和编译等常见问题.md</a>提到了python3.8和python2.7冲突的问题，那次是不同文件可以分别用不同版本的python运行，但是如果同一个文件里用到了python的两个版本，那就不好解决了。</p>
<p>比如一个文件需要用到python3的函数，然后发现<code>import tf</code>报错，没法用tf了，因为<code>tf2_ros</code>是针对python2编译的，为了适应python3 (melodic)，进行如下步骤：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt install python3-catkin-pkg-modules python3-rospkg-modules python3-empy</span><br><span class="line">Prepare catkin workspace</span><br><span class="line"></span><br><span class="line">mkdir -p ~/catkin_ws/src; <span class="built_in">cd</span> ~/catkin_ws</span><br><span class="line">catkin_make</span><br><span class="line"><span class="built_in">source</span> devel/setup.bash</span><br><span class="line">wstool init</span><br><span class="line">wstool <span class="built_in">set</span> -y src/geometry2 --git https://github.com/ros/geometry2 -v 0.6.5</span><br><span class="line">wstool up</span><br><span class="line">rosdep install --from-paths src --ignore-src -y -r</span><br><span class="line">Finally compile <span class="keyword">for</span> Python 3</span><br><span class="line"></span><br><span class="line">catkin_make --cmake-args \</span><br><span class="line">            -DCMAKE_BUILD_TYPE=Release \</span><br><span class="line">            -DPYTHON_EXECUTABLE=/usr/bin/python3 \</span><br><span class="line">            -DPYTHON_INCLUDE_DIR=/usr/include/python3.6m \</span><br><span class="line">            -DPYTHON_LIBRARY=/usr/lib/x86_64-linux-gnu/libpython3.6m.so</span><br><span class="line"><span class="built_in">source</span> devel/setup.bash</span><br></pre></td></tr></table></figure></p>
<p>参考：<br><a target="_blank" rel="noopener" href="https://answers.ros.org/question/326226/importerror-dynamic-module-does-not-define-module-export-function-pyinit__tf2/">ImportError: dynamic module does not define module export function (PyInit__tf2)</a></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/10/27/%E7%AE%97%E6%B3%95%E6%8E%A8%E5%AF%BC/%E5%8D%A1%E5%B0%94%E6%9B%BC%E6%BB%A4%E6%B3%A2%E7%9A%84%E6%8E%A8%E5%AF%BC%201/">卡尔曼滤波的推导(一)</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-10-27</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/%E7%AE%97%E6%B3%95%E6%8E%A8%E5%AF%BC/">算法推导</a></span><div class="content"><p>自己的情况，推一下观测方程和雅克比矩阵</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/10/27/%E7%AE%97%E6%B3%95%E6%8E%A8%E5%AF%BC/%E5%8D%A1%E5%B0%94%E6%9B%BC%E6%BB%A4%E6%B3%A2%E7%9A%84%E6%8E%A8%E5%AF%BC%202/">卡尔曼滤波的推导(二)</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-10-27</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/%E7%AE%97%E6%B3%95%E6%8E%A8%E5%AF%BC/">算法推导</a></span><div class="content"></div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/10/26/%E6%BF%80%E5%85%89SLAM/%E9%9B%B7%E8%BE%BE/%E6%AF%AB%E7%B1%B3%E6%B3%A2%E9%9B%B7%E8%BE%BE/">毫米波雷达</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-10-26</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/%E6%BF%80%E5%85%89SLAM/">激光SLAM</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/%E6%BF%80%E5%85%89SLAM/%E9%9B%B7%E8%BE%BE/">雷达</a></span><div class="content"><p>毫米波雷达：介于微波和红外线之间，频率范围10GHz—200GHz，毫米波的频段高于无线电，低于可见光和红外线，这是一个非常适合车载领域的频段，波长为毫米级。测距原理是把无线电波（雷达波/电磁波）发射出去，根据接收回波与发送之间的时间差测得目标位置距离数据。一般的探测距离在0-200米之间。安装也可以完全隐蔽，不影响车辆整体外观。因此毫米波雷达技术更适用于汽车防撞领域。</p>
<p>激光雷达：介于红外线和可见光之间，频率大致为100000GHz，波长为纳米级</p>
<p>毫米波雷达的探测距离受到频段损耗的直接制约（想要探测的远，就必须使用高频段雷达），也无法感知行人，并且对周边所有障碍物无法进行精准的建模。这一点就大不如激光雷达。</p>
<p>激光雷达发射的电磁波是一条直线，主要以光粒子发射为主要方法，而毫米波雷达发射出去的电磁波是一个锥状的波束，这个波段的天线主要以电磁辐射为主。</p>
<p>从抗干扰能力上来讲，由于激光雷达通过发射光束进行探测，受环境影响较大，光束受遮挡后就不能正常使用，因此无法在雨雪雾霾天，沙尘暴等恶劣天气中开启，而毫米波的引导头穿透雾、烟、灰尘的能力强，因此可以在糟糕的天气中探测，在这一点上毫米波雷达更胜一筹。</p>
<p>激光雷达获取的数据量远超毫米波雷达，所以需要更高性能的处理器来处理数据，成本高了，售价自然就更贵了。</p>
<p>一般毫米波雷达的数据格式就是z=(a,r,s)，其中a表示物体相对于汽车的角度，r表示和汽车之间的距离，s表示径向速度。而一次扫描会有很多的物体，结果就会变成 (z1, z2, z3…)。</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/10/22/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92/%E5%85%A8%E5%B1%80%E8%B7%AF%E5%BE%84/%E5%85%A8%E5%B1%80%E8%B7%AF%E5%BE%84%E4%B8%8D%E6%AD%A3%E5%B8%B8%E7%9A%84%E8%A7%84%E5%88%92%E5%A4%B1%E8%B4%A5/">全局路径不正常的规划失败</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-10-22</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92/">路径规划</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92/%E5%85%A8%E5%B1%80%E8%B7%AF%E5%BE%84%E7%AE%97%E6%B3%95/">全局路径算法</a></span><div class="content"><p>精灵2所用全局路径的参数<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">planner_window_x: <span class="number">0.0</span></span><br><span class="line">planner_window_y: <span class="number">0.0</span></span><br><span class="line">default_tolerance: <span class="number">0.0</span></span><br><span class="line"></span><br><span class="line">publish_scale: <span class="number">100</span></span><br><span class="line">planner_costmap_publish_frequency: <span class="number">0.0</span></span><br></pre></td></tr></table></figure></p>
<p><img src="https://i.loli.net/2021/10/22/XZNH9QPWKsdBh76.png" alt="全局路径很奇怪.png"><br><img src="https://i.loli.net/2021/10/22/1Pb3XQe5Tnv8Mjk.png" alt="全局路径失败时的报错.png"><br><img src="https://i.loli.net/2021/10/25/YoQAJSDxRZdnrzw.png" alt="全局路径规划失败"></p>
<p>看代码<code>GlobalPlanner::makePlan</code>中的<code>if (found_legal)</code>部分，再看<code>GlobalPlanner::getPlanFromPotential</code>函数，继续定位到<code>path_maker_-&gt;getPath</code>。这里就需要看<code>path_maker</code>是什么东西，在文件中发现<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (use_grid_path)   <span class="comment">// 参数</span></span><br><span class="line">    <span class="comment">//栅格路径，从终点开始找上下或左右4个中最小的栅格直到起点</span></span><br><span class="line">    path_maker_ = <span class="keyword">new</span> <span class="built_in">GridPath</span>(p_calc_);</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="comment">//梯度路径，从周围八个栅格中找到下降梯度最大的点</span></span><br><span class="line">path_maker_ = <span class="keyword">new</span> <span class="built_in">GradientPath</span>(p_calc_);</span><br></pre></td></tr></table></figure><br><code>use_grid_path</code>默认是false，所以一般用<code>GradientPath</code>，最终看<code>GradientPath::getPath</code>为什么返回false</p>
<p>将<code>if (fabs(nx - start_x) &lt; .5 &amp;&amp; fabs(ny - start_y) &lt; .5)</code> 中的0.5改为1</p>
<p>查来查去，终于发现其实就是全局代价地图里，本来就处于障碍的附近，所以规划如此奇怪。只是换到了室外环境，不习惯看全局代价地图了<br><img src="https://i.loli.net/2021/10/25/Cv9ncJuRMY4IoeU.png" alt=""></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/10/21/%E6%BF%80%E5%85%89SLAM/%E5%A4%9A%E4%BC%A0%E6%84%9F%E5%99%A8%E8%9E%8D%E5%90%88/%E4%BC%A0%E6%84%9F%E5%99%A8%E8%9E%8D%E5%90%88%20%20%E6%97%B6%E9%97%B4%E5%90%8C%E6%AD%A5/">传感器数据的时间同步</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-10-21</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/%E6%BF%80%E5%85%89SLAM/">激光SLAM</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/%E6%BF%80%E5%85%89SLAM/%E5%A4%9A%E4%BC%A0%E6%84%9F%E5%99%A8%E8%9E%8D%E5%90%88/">多传感器融合</a></span><div class="content"><p>多传感器数据融合的时候，由于各个传感器采集数据的频率的不同，例如odom 50Hz、Imu 100Hz、camera 25Hz，需要将传感器数据进行时间同步后才能进行融合。</p>
<p>分别订阅不同的需要融合的传感器的主题，通过<code>TimeSynchronizer</code>统一接收多个主题，只有在所有的topic都有相同的时间戳时，才会产生一个同步结果的回调函数，在回调函数里处理同步时间后的数据。</p>
<p>注意: 只有多个主题都有数据的时候才可以触发回调函数。如果其中一个主题的发布节点崩溃了，则整个回调函数永远无法触发回调。 <strong>频率一般趋于和最低的频率一样。</strong> 当多个主题频率一致的时候，回调函数的频率(融合后的频率)可能会小于订阅主题的频率。</p>
<p>对齐传感信息时间戳有两种方式, 一种是时间戳完全对齐 <strong>ExactTime Policy</strong>, 另一种是时间戳相近 <strong>ApproximateTime Policy</strong>, 前者更为严格, 但有时会没有结果而无法进行回调函数。所以一般还是用后者</p>
<p><a target="_blank" rel="noopener" href="http://wiki.ros.org/message_filters">message_filters</a><br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/long5683/p/13223458.html">message_filters::Synchronizer的使用</a><br><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_21830903/article/details/106532143">传感器数据之间的时间同步问题</a></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/10/18/octomap%E5%92%8C%E5%85%AB%E5%8F%89%E6%A0%91/octomap_server/">octomap_server</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-10-18</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/octomap%E5%92%8C%E5%85%AB%E5%8F%89%E6%A0%91/">octomap和八叉树</a></span><div class="content"><p><code>octomap_server</code>除了将点云地图转化为基于Octree的OctoMap，还能将点云地图转化为二维地图。可以增量建3D的 OctoMaps，还提供了能保存地图的节点<code>octomap_saver</code>.<br><code>octomap_server</code>节点很消耗内存，增量建图的过程中内存持续上升，因为当中不存在内存释放，没有静态储存八叉树图信息</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;octomap_server&quot;</span> <span class="attr">type</span>=<span class="string">&quot;octomap_server_node&quot;</span> <span class="attr">name</span>=<span class="string">&quot;octomap_server&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- resolution in meters per pixel --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;resolution&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0.05&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- name of the fixed frame, needs to be &quot;/map&quot; for SLAM --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;frame_id&quot;</span> <span class="attr">type</span>=<span class="string">&quot;string&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$(arg frame_id)&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;sensor_model/max_range&quot;</span> <span class="attr">value</span>=<span class="string">&quot;150.0&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;latch&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 需要和 publish_pointcloud 的frame_id相同，否则会导致Octomap没有发布数据 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- topic from where pointcloud2 messages are subscribed，改为自己的点云话题 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">remap</span> <span class="attr">from</span>=<span class="string">&quot;/cloud_in&quot;</span> <span class="attr">to</span>=<span class="string">&quot;$(arg cloud_topic)&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">remap</span> <span class="attr">from</span>=<span class="string">&quot;/projected_map&quot;</span> <span class="attr">to</span>=<span class="string">&quot;$(arg map_topic)&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">node</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>也就是将点云数据发布到一个指定的 topic 上,然后调用 Octomap 在ROS下的srv组件进行实时转换,并发布到另外一个 Octomap topic 上去.最后通过rviz 进行显示Octomap。注意octomap的输入话题（topic）和数据的坐标系(frame_id)两个参数的设置，通常octomap 没有数据输出都是由于这两个参数设置错误导致的。</p>
<h2 id="话题"><a href="#话题" class="headerlink" title="话题"></a>话题</h2><p>运行此launch文件会有如下话题：</p>
<h2 id="Rviz配置"><a href="#Rviz配置" class="headerlink" title="Rviz配置"></a>Rviz配置</h2><p>安装<code>octomap-rviz-plugins</code>后，打开rviz,这时候点开Add选项，会多一个<code>octomap_rviz_plugins</code>模组。 其中的OccupancyGrid是显示三维概率地图，也就是octomap地图。OccupancyMap是显示二维占据栅格地图。<br><img src="https://i.loli.net/2021/10/18/xnEIHFoeLWtTY9a.png" alt=""><br>打开rviz，在里面添加OccupancyGrid，OccupancyMap，Map显示选项,显示话题选择<code>octomap_full</code>或者<code>octomap_binary</code></p>
<p>octomap topics are 3D occupancy maps, which would be used by some other 3D planning approach (e.g., move_it). They are not the same as /grid_map or /proj_map from rtabmap_ros.   For 3D trajectories (having to move in Z, e.g., quadcopter), then using OctoMap with OMPL/move_it can be another approach, though not sure if there is one most popular approach for the 3D case.</p>
<p>参考：<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/crp997576280/article/details/74605766">Octomap在ROS环境下实时显示，但点云来源是ORB稠密点云</a></p>
</div><hr></div><nav id="pagination"><div class="pagination"><span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/46/">46</a><a class="extend next" rel="next" href="/page/2/">Next &gt;&gt;</a></div></nav></div></div><footer class="footer-bg" style="background-image: url(https://i.loli.net/2021/07/13/RCLw5Bx8aFPN74b.jpg)"><div class="layout" id="footer"><div class="copyright">&copy;2018 - 2021 By Charon Cheung</div><div class="framework-info"><span>Driven - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_site_uv"><i class="fa fa-user"></i><span id="busuanzi_value_site_uv"></span><span></span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_site_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.6.1"></script><script src="/js/fancybox.js?version=1.6.1"></script><script src="/js/sidebar.js?version=1.6.1"></script><script src="/js/copy.js?version=1.6.1"></script><script src="/js/fireworks.js?version=1.6.1"></script><script src="/js/transition.js?version=1.6.1"></script><script src="/js/scroll.js?version=1.6.1"></script><script src="/js/head.js?version=1.6.1"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
    processEscapes: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
  },
  CommonHTML: {
    linebreaks: { automatic: true, width: "90% container" }
  },
  "HTML-CSS": { 
    linebreaks: { automatic: true, width: "90% container" }
  },
  "SVG": { 
    linebreaks: { automatic: true, width: "90% container" }
  }
});
</script><script type="text/x-mathjax-config">MathJax.Hub.Queue(function() {
  var all = MathJax.Hub.getAllJax(), i;
  for (i=0; i < all.length; i += 1) {
    all[i].SourceElement().parentNode.className += ' has-jax';
  }
});
</script><script src="https://cdn.bootcss.com/mathjax/2.7.2/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script>if(/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
}</script></body></html>