<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content=""><meta name="keywords" content=""><meta name="author" content="Charon Cheung"><meta name="copyright" content="Charon Cheung"><title>If you wish for peace, prepare for war | Silent Assassin</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.6.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.6.1"><link rel="dns-prefetch" href="https://cdn.staticfile.org"><link rel="dns-prefetch" href="https://cdn.bootcss.com"><link rel="dns-prefetch" href="https://creativecommons.org"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  }
} </script><meta name="generator" content="Hexo 5.4.0"></head><body><canvas class="fireworks"></canvas><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar"><div class="author-info"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">Charon Cheung</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">450</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">5</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">41</span></a></div></div></div><nav id="nav" style="background-image: url(https://i.loli.net/2021/07/13/RCLw5Bx8aFPN74b.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">Silent Assassin</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus"><a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span></div><div id="site-info"><div id="site-title">Silent Assassin</div><div id="site-sub-title">If you wish for peace, prepare for war</div></div></nav><div id="content-outer"><div class="layout" id="content-inner"><div class="recent-post-item article-container"><a class="article-title" href="/2021/09/20/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92/DWA%E7%AE%97%E6%B3%95/DWA%E7%AE%97%E6%B3%95(%E4%BA%94)%20%E5%A6%82%E4%BD%95%E8%A7%A6%E5%8F%91latched%E6%9C%BA%E5%88%B6/">DWA算法(五) 如何触发latched机制</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-09-20</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92/">路径规划</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92/DWA%E7%AE%97%E6%B3%95/">DWA算法</a></span><div class="content"><p>DWA摆动问题</p>
<p>Testing DWA Local Planner - approaches goal, stops, keeps swinging left &amp; right</p>
<p>I’m trying the DWA Local Planner as an alternative for the TrajectoryPlanner. At first it moves heading to the given goal pretty fast. But close to the goal, that is about half a meter which still is quite a distance considering that the whole world of the robot is just a plane of 2 by 3 meters, it kind of stops and keeps like dancing in place.</p>
<p>I’m quite sure that it’s because the <code>latch_xy_goal_tolerance</code> is not working well. <code>latch_xy_goal_tolerance</code> is designed to prevent robot moving once reaching the goal position. If we close it, the robot may go away from the goal then start local planning again during the in place rotating stage. So we can see the robot dancing sometimes. To check this, you can set latch_xy_goal_tolerance to false and should see the robot dancing in the same way.<br>The problem is from global planning. <strong>We don’t want the robot being latched if we get a new goal, so when there is a new global plan, move_base will reset Latching.</strong> However, the global planning is never closed before we reach the goal position and orientation. During the last rotating stage, the orientation haven’t been reached, so latching is reset.<br>An easy way to fix this bug is checking the global plan’s goal before resetting latching in function <code>DWAPlannerROS::setPlan</code>. If <code>latch_xy_goal_tolerance</code> is what we want and global plan’s goal is not changed (so we need to record an old goal), don’t reset the latching.</p>
<p>There is another quick dirty way, just set planner_frequency in move_base params to zero, then global planner will only work when we get a new goal or local planner fails, so latching won’t be reset too often.</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/09/20/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92/DWA%E7%AE%97%E6%B3%95/DWA%E7%AE%97%E6%B3%95(%E4%B8%80)%20%E5%8E%9F%E7%90%86/">DWA算法(一) 原理</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-09-20</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92/">路径规划</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92/DWA%E7%AE%97%E6%B3%95/">DWA算法</a></span><div class="content"></div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/09/20/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92/DWA%E7%AE%97%E6%B3%95/DWA%E7%AE%97%E6%B3%95(%E5%9B%9B)%20dwaComputeVelocityCommands/">DWA算法(四) dwaComputeVelocityCommands</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-09-20</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92/">路径规划</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92/DWA%E7%AE%97%E6%B3%95/">DWA算法</a></span><div class="content"><p>接上一篇，分析如果还没到x y误差范围内，进行DWA规划的情况<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">bool</span> isOk = <span class="built_in">dwaComputeVelocityCommands</span>(current_pose_, cmd_vel);</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (isOk)</span><br><span class="line">    <span class="built_in">publishGlobalPlan</span>(transformed_plan);</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    <span class="built_in">ROS_WARN_NAMED</span>(<span class="string">&quot;dwa_local_planner&quot;</span>, <span class="string">&quot;DWA planner failed to produce path.&quot;</span>);</span><br><span class="line">    std::vector&lt;geometry_msgs::PoseStamped&gt; empty_plan;</span><br><span class="line">    <span class="built_in">publishGlobalPlan</span>(empty_plan);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> isOk;</span><br></pre></td></tr></table></figure></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/09/20/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92/DWA%E7%AE%97%E6%B3%95/DWA%E7%AE%97%E6%B3%95(%E4%B8%89)%20latched%20Stop%20Rotate/">DWA算法(三) latched Stop Rotate</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-09-20</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92/">路径规划</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92/DWA%E7%AE%97%E6%B3%95/">DWA算法</a></span><div class="content"><p>接着上一篇，继续<code>DWAPlannerROS::computeVelocityCommands</code></p>
<p>如果x y坐标已经在目标的距离误差范围内<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (latchedStopRotateController_.<span class="built_in">isPositionReached</span>(</span><br><span class="line">      &amp;planner_util_, current_pose_)  )</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//publish an empty plan because we&#x27;ve reached our goal position</span></span><br><span class="line">  std::vector&lt;geometry_msgs::PoseStamped&gt; local_plan;</span><br><span class="line">  std::vector&lt;geometry_msgs::PoseStamped&gt; transformed_plan;</span><br><span class="line">  <span class="built_in">publishGlobalPlan</span>(transformed_plan);</span><br><span class="line">  <span class="built_in">publishLocalPlan</span>(local_plan);</span><br><span class="line">  base_local_planner::LocalPlannerLimits limits = planner_util_.<span class="built_in">getCurrentLimits</span>();</span><br><span class="line">  <span class="keyword">return</span> latchedStopRotateController_.<span class="built_in">computeVelocityCommandsStopRotate</span>(</span><br><span class="line">      cmd_vel,</span><br><span class="line">      limits.<span class="built_in">getAccLimits</span>(),</span><br><span class="line">      dp_-&gt;<span class="built_in">getSimPeriod</span>(),</span><br><span class="line">      &amp;planner_util_,</span><br><span class="line">      odom_helper_,</span><br><span class="line">      current_pose_,</span><br><span class="line">      boost::<span class="built_in">bind</span>(&amp;DWAPlanner::checkTrajectory, dp_, _1, _2, _3));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br><code>latchedStopRotateController_</code> 是 <code>base_local_planner::LatchedStopRotateController</code>，它用到一个参数<code>latch_xy_goal_tolerance</code></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/09/20/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92/DWA%E7%AE%97%E6%B3%95/DWA%E7%AE%97%E6%B3%95(%E4%BA%8C)%20dwa_ros%20%E6%BA%90%E7%A0%81/">DWA算法(二) dwa_ros 源码</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-09-20</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92/">路径规划</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92/DWA%E7%AE%97%E6%B3%95/">DWA算法</a></span><div class="content"><p>这里就是<code>DWAPlannerROS</code>类的源码，继承自<code>nav_core::BaseLocalPlanner</code>。 但是它还用到了<code>base_local_planner</code>的<code>LatchedStopRotateController</code>模块，用于latch机制和到达位置后转向。</p>
<h2 id="initialize"><a href="#initialize" class="headerlink" title="initialize"></a>initialize</h2><p>原型是<code>void DWAPlannerROS::initialize(std::string name, tf2_ros::Buffer* tf, costmap_2d::Costmap2DROS* costmap_ros)</code></p>
<p>其实主要是<code>if( !isInitialized())</code>的部分，直接看里面的内容</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">ros::NodeHandle <span class="title">private_nh</span><span class="params">(<span class="string">&quot;~/&quot;</span> + name)</span></span>;</span><br><span class="line">g_plan_pub_ = private_nh.advertise&lt;nav_msgs::Path&gt;(<span class="string">&quot;global_plan&quot;</span>, <span class="number">1</span>);</span><br><span class="line">l_plan_pub_ = private_nh.advertise&lt;nav_msgs::Path&gt;(<span class="string">&quot;local_plan&quot;</span>, <span class="number">1</span>);</span><br><span class="line">tf_ = tf;</span><br><span class="line">costmap_ros_ = costmap_ros;</span><br><span class="line"><span class="comment">// 在局部代价地图中的位姿</span></span><br><span class="line">costmap_ros_-&gt;<span class="built_in">getRobotPose</span>(current_pose_);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 局部代价地图</span></span><br><span class="line">costmap_2d::Costmap2D* costmap = costmap_ros_-&gt;<span class="built_in">getCostmap</span>();</span><br><span class="line"><span class="comment">// base_local_planner::LocalPlannerUtil</span></span><br><span class="line"><span class="comment">// 其实就是把三个参数赋值给 LocalPlannerUtil 的三个成员变量</span></span><br><span class="line">planner_util_.<span class="built_in">initialize</span>(tf, costmap, costmap_ros_-&gt;<span class="built_in">getGlobalFrameID</span>());</span><br><span class="line"></span><br><span class="line"><span class="comment">//这里是创建了dwa的共享指针，也就是  boost::shared_ptr&lt;DWAPlanner&gt; dp_;</span></span><br><span class="line">dp_ = boost::shared_ptr&lt;DWAPlanner&gt;(<span class="keyword">new</span> <span class="built_in">DWAPlanner</span>(name, &amp;planner_util_));</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>( private_nh.<span class="built_in">getParam</span>( <span class="string">&quot;odom_topic&quot;</span>, odom_topic_ ))</span><br><span class="line">&#123;</span><br><span class="line">  odom_helper_.<span class="built_in">setOdomTopic</span>( odom_topic_ );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">initialized_ = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Warn about deprecated parameters -- remove this block in N-turtle</span></span><br><span class="line"><span class="comment">// 这些不必关注</span></span><br><span class="line">nav_core::<span class="built_in">warnRenamedParameter</span>(private_nh, <span class="string">&quot;max_vel_trans&quot;</span>, <span class="string">&quot;max_trans_vel&quot;</span>);</span><br><span class="line">nav_core::<span class="built_in">warnRenamedParameter</span>(private_nh, <span class="string">&quot;min_vel_trans&quot;</span>, <span class="string">&quot;min_trans_vel&quot;</span>);</span><br><span class="line">nav_core::<span class="built_in">warnRenamedParameter</span>(private_nh, <span class="string">&quot;max_vel_theta&quot;</span>, <span class="string">&quot;max_rot_vel&quot;</span>);</span><br><span class="line">nav_core::<span class="built_in">warnRenamedParameter</span>(private_nh, <span class="string">&quot;min_vel_theta&quot;</span>, <span class="string">&quot;min_rot_vel&quot;</span>);</span><br><span class="line">nav_core::<span class="built_in">warnRenamedParameter</span>(private_nh, <span class="string">&quot;acc_lim_trans&quot;</span>, <span class="string">&quot;acc_limit_trans&quot;</span>);</span><br><span class="line">nav_core::<span class="built_in">warnRenamedParameter</span>(private_nh, <span class="string">&quot;theta_stopped_vel&quot;</span>, <span class="string">&quot;rot_stopped_vel&quot;</span>);</span><br><span class="line"><span class="comment">// 动态调整</span></span><br><span class="line">dsrv_ = <span class="keyword">new</span> dynamic_reconfigure::Server&lt;DWAPlannerConfig&gt;(private_nh);</span><br><span class="line">dynamic_reconfigure::Server&lt;DWAPlannerConfig&gt;::CallbackType cb = boost::<span class="built_in">bind</span>(&amp;DWAPlannerROS::reconfigureCB, <span class="keyword">this</span>, _1, _2);</span><br><span class="line">dsrv_-&gt;<span class="built_in">setCallback</span>(cb);</span><br></pre></td></tr></table></figure>
<p>DWA的参数基本都在<code>TrajectoryPlannerROS::initialize</code>里加载。</p>
<h2 id="computeVelocityCommands"><a href="#computeVelocityCommands" class="headerlink" title="computeVelocityCommands"></a>computeVelocityCommands</h2><p>根据机器人离目标是否足够接近，路径规划由<code>dwa sampling</code>或者<code>stop and rotate</code>负责。</p>
<p>先是全局路径的处理</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 开始规划时再次获取位姿</span></span><br><span class="line"><span class="keyword">if</span> ( !costmap_ros_-&gt;<span class="built_in">getRobotPose</span>(current_pose_))</span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">ROS_ERROR</span>(<span class="string">&quot;Could not get robot pose&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// TEB的部分全局路径也叫 transformed_plan，应该是因为下面的getLocalPlan参数也是这个名字</span></span><br><span class="line">std::vector&lt;geometry_msgs::PoseStamped&gt; transformed_plan;</span><br><span class="line"><span class="comment">// 获取全局路径</span></span><br><span class="line"><span class="keyword">if</span> ( !planner_util_.<span class="built_in">getLocalPlan</span>(current_pose_, transformed_plan) )</span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">ROS_ERROR</span>(<span class="string">&quot;Could not get local plan&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(transformed_plan.<span class="built_in">empty</span>())</span><br><span class="line">&#123;</span><br><span class="line">  <span class="built_in">ROS_WARN_NAMED</span>(<span class="string">&quot;dwa_local_planner&quot;</span>, <span class="string">&quot;Received an empty transformed plan.&quot;</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">ROS_DEBUG_NAMED</span>(<span class="string">&quot;dwa_local_planner&quot;</span>, <span class="string">&quot;Received a transformed plan with %zu points.&quot;</span>, transformed_plan.<span class="built_in">size</span>());</span><br></pre></td></tr></table></figure>
<p>上面的<code>planner_util_.getLocalPlan</code>的内容实际是：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">base_local_planner::<span class="built_in">transformGlobalPlan</span>(</span><br><span class="line">      *tf_,</span><br><span class="line">      global_plan_,</span><br><span class="line">      global_pose,</span><br><span class="line">      *costmap_,</span><br><span class="line">      global_frame_,</span><br><span class="line">      transformed_plan)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(limits_.prune_plan)   </span><br><span class="line">&#123;</span><br><span class="line">    base_local_planner::<span class="built_in">prunePlan</span>(global_pose, transformed_plan, global_plan_);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>涉及到了DWA的参数<code>prune_plan</code>，如果需要剪辑全局路径，就进入<code>base_local_planner::prunePlan</code>，此函数在<code>goal_funtions.cpp</code>，一看就是在namespace里。这里不如TEB的剪切全局路径复杂，其实就是把机器人当前位姿身后的部分剪掉，这部分是从路径起点到离位姿的欧氏距离的平方不到1米的点，这个1米已经写死，不能用参数更改。</p>
<h2 id="updatePlanAndLocalCosts"><a href="#updatePlanAndLocalCosts" class="headerlink" title="updatePlanAndLocalCosts"></a>updatePlanAndLocalCosts</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// update plan in dwa_planner even if we just stop and rotate, to allow checkTrajectory</span></span><br><span class="line">dp_-&gt;<span class="built_in">updatePlanAndLocalCosts</span>(current_pose_,  transformed_plan, </span><br><span class="line">     costmap_ros_-&gt;<span class="built_in">getRobotFootprint</span>()  );</span><br></pre></td></tr></table></figure>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DWAPlanner::updatePlanAndLocalCosts</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">      <span class="keyword">const</span> geometry_msgs::PoseStamped&amp;  global_pose,</span></span></span><br><span class="line"><span class="params"><span class="function">      <span class="keyword">const</span> std::vector&lt;geometry_msgs::PoseStamped&gt;&amp;  new_plan,</span></span></span><br><span class="line"><span class="params"><span class="function">      <span class="keyword">const</span> std::vector&lt;geometry_msgs::Point&gt;&amp; footprint_spec)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    global_plan_.<span class="built_in">resize</span>(new_plan.<span class="built_in">size</span>());</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">unsigned</span> <span class="keyword">int</span> i = <span class="number">0</span>; i &lt; new_plan.<span class="built_in">size</span>(); ++i)</span><br><span class="line">    &#123;</span><br><span class="line">      global_plan_[i] = new_plan[i];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    obstacle_costs_.<span class="built_in">setFootprint</span>(footprint_spec);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// costs for going away from path</span></span><br><span class="line">    path_costs_.<span class="built_in">setTargetPoses</span>(global_plan_);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// costs for not going towards the local goal as much as possible</span></span><br><span class="line">    goal_costs_.<span class="built_in">setTargetPoses</span>(global_plan_);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// alignment costs</span></span><br><span class="line">    geometry_msgs::PoseStamped goal_pose = global_plan_.<span class="built_in">back</span>();</span><br><span class="line"></span><br><span class="line">    <span class="function">Eigen::Vector3f <span class="title">pos</span><span class="params">(global_pose.pose.position.x, global_pose.pose.position.y, tf2::getYaw(global_pose.pose.orientation))</span></span>;</span><br><span class="line">    <span class="keyword">double</span> sq_dist =</span><br><span class="line">        (pos[<span class="number">0</span>] - goal_pose.pose.position.x) * (pos[<span class="number">0</span>] - goal_pose.pose.position.x) </span><br><span class="line">                                             +</span><br><span class="line">        (pos[<span class="number">1</span>] - goal_pose.pose.position.y) * (pos[<span class="number">1</span>] - goal_pose.pose.position.y);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// we want the robot nose to be drawn to its final position</span></span><br><span class="line">    <span class="comment">// (before robot turns towards goal orientation), not the end of the</span></span><br><span class="line">    <span class="comment">// path for the robot center. Choosing the final position after</span></span><br><span class="line">    <span class="comment">// turning towards goal orientation causes instability when the</span></span><br><span class="line">    <span class="comment">// robot needs to make a 180 degree turn at the end</span></span><br><span class="line">    std::vector&lt;geometry_msgs::PoseStamped&gt; front_global_plan = global_plan_;</span><br><span class="line">    <span class="keyword">double</span> angle_to_goal = <span class="built_in">atan2</span>(goal_pose.pose.position.y - pos[<span class="number">1</span>], goal_pose.pose.position.x - pos[<span class="number">0</span>]);</span><br><span class="line"></span><br><span class="line">    front_global_plan.<span class="built_in">back</span>().pose.position.x = front_global_plan.<span class="built_in">back</span>().pose.position.x +</span><br><span class="line">      forward_point_distance_ * <span class="built_in">cos</span>(angle_to_goal);</span><br><span class="line">    front_global_plan.<span class="built_in">back</span>().pose.position.y = front_global_plan.<span class="built_in">back</span>().pose.position.y + forward_point_distance_ *</span><br><span class="line">      <span class="built_in">sin</span>(angle_to_goal);</span><br><span class="line"></span><br><span class="line">    goal_front_costs_.<span class="built_in">setTargetPoses</span>(front_global_plan);</span><br><span class="line">    </span><br><span class="line">   <span class="comment">// keeping the nose on the path</span></span><br><span class="line">  <span class="keyword">if</span> (sq_dist &gt; forward_point_distance_ * forward_point_distance_ * cheat_factor_)</span><br><span class="line">  &#123;</span><br><span class="line">    alignment_costs_.<span class="built_in">setScale</span>(path_distance_bias_);</span><br><span class="line">    <span class="comment">// costs for robot being aligned with path (nose on path, not ju</span></span><br><span class="line">    alignment_costs_.<span class="built_in">setTargetPoses</span>(global_plan_);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">    <span class="comment">// once we are close to goal, trying to keep the nose close to anything destabilizes behavior.</span></span><br><span class="line">    alignment_costs_.<span class="built_in">setScale</span>(<span class="number">0.0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/09/15/SLAM%E5%B7%A5%E5%85%B7/Eigen(%E4%BA%8C)%20%E7%89%B9%E5%BE%81%E5%80%BC%EF%BC%8C%E5%B9%B3%E7%A7%BB/">Eigen(二) 特征值，平移</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-09-15</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/SLAM%E5%B7%A5%E5%85%B7/">SLAM工具</a></span><div class="content"><h2 id="计算特征值与特征向量"><a href="#计算特征值与特征向量" class="headerlink" title="计算特征值与特征向量"></a>计算特征值与特征向量</h2><p>构造一个EigenSolver，然后分别调用其成员函数.eigenvalues()、.eigenvectors()即可获得特征值与特征向量。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;Eigen/Eigenvalues&gt;</span></span></span><br><span class="line"></span><br><span class="line">A &lt;&lt; <span class="number">2</span>,<span class="number">-2</span>,<span class="number">0</span>, <span class="number">-2</span>,<span class="number">1</span>,<span class="number">-2</span>, <span class="number">0</span>,<span class="number">-2</span>,<span class="number">0</span>;</span><br><span class="line"><span class="function">EigenSolver&lt;Matrix3d&gt; <span class="title">eigensolver</span><span class="params">(A)</span></span>;</span><br><span class="line"><span class="keyword">if</span> (eigensolver.<span class="built_in">info</span>() == Success)</span><br><span class="line">&#123;</span><br><span class="line">    cout &lt;&lt; eigensolver.<span class="built_in">eigenvalues</span>() &lt;&lt; endl&lt;&lt;endl;</span><br><span class="line">    cout &lt;&lt; eigensolver.<span class="built_in">eigenvectors</span>() &lt;&lt; endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>输出结果并不是我们平时熟悉的形式，而是<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">(4,0)</span><br><span class="line">(1,0)</span><br><span class="line">(-2,0)</span><br><span class="line"></span><br><span class="line">(-0.666667,0) (-0.666667,0) (-0.333333,0)</span><br><span class="line">(0.666667,0) (-0.333333,0) (-0.666667,0)</span><br><span class="line">(-0.333333,0)  (0.666667,0) (-0.666667,0)</span><br></pre></td></tr></table></figure><br>实际特征值是4,1,-2.   4对应的特征向量分别为<code>(-0.666667, -0.666667,-0.333333)</code></p>
<h2 id="旋转"><a href="#旋转" class="headerlink" title="旋转"></a>旋转</h2><p>有旋转向量、四元数和旋转矩阵三种表示方法，在Eigen里用前两种进行定义，这样参数少，可以转化为第三种。</p>
<p>牢记下面这张图，根据《视觉SLAM十四讲》总结：<br><img src="https://i.loli.net/2020/03/03/itMb4fy9uzjs6Rl.png" alt="三种方式的转换"></p>
<p>使用的是模板类：<code>class Eigen::AngleAxis&lt; Scalar &gt;</code>，这被称为角轴表示法，顾名思义给定旋转角度和旋转轴即可。其创建方式符合Eigen的原则，传入数据类型作为模板参数。旋转角度以弧度表示，旋转轴为Vector类型的向量，注意向量必须要被归一化(<code>vec.normalized()</code>即可)。Eigen中也预先定义好了<code>AngleAxisd</code>和<code>AngleAxisf</code>两种方便使用。</p>
<p>参考:<a target="_blank" rel="noopener" href="https://blog.csdn.net/weicao1990/article/details/86148828">基于eigen实现欧拉角(RPY), 旋转矩阵, 旋转向量, 四元数之间的变换</a></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Vector3f v1 = Vector3f::<span class="built_in">UnitX</span>();</span><br><span class="line"></span><br><span class="line"><span class="function">AngleAxisf <span class="title">aa</span><span class="params">(<span class="number">45</span>*<span class="number">3.1415</span>/<span class="number">180</span>, v1)</span></span>;</span><br><span class="line"><span class="comment">// 返回弧度制表示的旋转角度 和 旋转轴(列向量)</span></span><br><span class="line">cout &lt;&lt; aa.<span class="built_in">angle</span>() &lt;&lt;<span class="string">&quot;  &quot;</span>&lt;&lt;endl&lt;&lt; aa.<span class="built_in">axis</span>() &lt;&lt;endl; </span><br><span class="line">cout &lt;&lt; aa.<span class="built_in">toRotationMatrix</span>()&lt;&lt;endl;   <span class="comment">// 转换为3 × 3的旋转矩阵</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// fromRotationMatrix():从一个3×3的旋转矩阵构建AngleAxis对象。也就是提取旋转矩阵所表示的旋转角</span></span><br><span class="line"><span class="comment">//  inverse(): 返回以AngleAxis表示的当前旋转的逆旋转</span></span><br></pre></td></tr></table></figure>
<p>Quaternion是四元数表示法，Quaternion的构造是标准Eigen格式：数据类型作为模板参数+构造参数，而且重载了多个构造函数，因此可以方便地从角轴、旋转矩阵等数据类型进行构造。<font color = blue size=4>特别需要注意四个数的传入顺序是w、x、y、z，对应w+xi+yj+zk。 </font>Eigen也提供了Quaternionf和Quaterniond方便使用。</p>
<ul>
<li><p>构造函数的参数可以是AngleAxis或(w,x,y,z)</p>
</li>
<li><p>w():返回四元数中的w分量</p>
</li>
<li><p>x():返回四元数中的x分量</p>
</li>
<li><p>y():返回四元数中的y分量</p>
</li>
<li><p>z():返回四元数中的z分量</p>
</li>
<li><p>coeffs():返回四元数的四个数，可以对其进行索引[]获取值。需要注意的是返回顺序是x、y、z、w，和构造函数的不同</p>
</li>
<li><p>toRotationMatrix() 将当前Quaternion对象转换为3×3的旋转矩阵。另外，没有fromRotationMatrix()函数，只能用构造函数传入旋转矩阵</p>
</li>
<li><p>slerp():对两个四元数进行球面线性插值(Spherical linear interpolation，通常简称Slerp)，是四元数的一种线性插值运算，主要用于在两个表示旋转的四元数之间平滑差值。</p>
</li>
</ul>
<h3 id="欧拉角-——-旋转矩阵"><a href="#欧拉角-——-旋转矩阵" class="headerlink" title="欧拉角 —— 旋转矩阵"></a>欧拉角 —— 旋转矩阵</h3><p>可以让三个<code>AngleAxis</code>相乘：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 参数顺序和 static_transform_publisher 的一致</span></span><br><span class="line"><span class="function">Eigen::Vector3f <span class="title">angle</span><span class="params">(roll, pitch, yaw)</span></span>;</span><br><span class="line">Eigen::Matrix3d rotation;</span><br><span class="line">rotation = Eigen::<span class="built_in">AngleAxisd</span>(angle[<span class="number">0</span>], Eigen::Vector3d::<span class="built_in">UnitZ</span>()) *</span><br><span class="line">           Eigen::<span class="built_in">AngleAxisd</span>(angle[<span class="number">1</span>], Eigen::Vector3d::<span class="built_in">UnitY</span>()) *</span><br><span class="line">           Eigen::<span class="built_in">AngleAxisd</span>(angle[<span class="number">2</span>], Eigen::Vector3d::<span class="built_in">UnitX</span>()) ;</span><br></pre></td></tr></table></figure><br>这样计算的结果和每个AngleAxisf转换成旋转矩阵后再相乘得到的结果是相同的</p>
<h3 id="四元数-——-旋转矩阵"><a href="#四元数-——-旋转矩阵" class="headerlink" title="四元数 —— 旋转矩阵"></a>四元数 —— 旋转矩阵</h3><p>其实这样更简单，我们可以直接从<code>tf2_ros::Buffer</code>和<code>geometry_msgs::TransformStamped</code>直接获得四元数<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Eigen::Quaterniond <span class="title">quaternion</span><span class="params">(transform.transform.rotation.w,</span></span></span><br><span class="line"><span class="params"><span class="function">                              transform.transform.rotation.x,</span></span></span><br><span class="line"><span class="params"><span class="function">                              transform.transform.rotation.y,</span></span></span><br><span class="line"><span class="params"><span class="function">                              transform.transform.rotation.z</span></span></span><br><span class="line"><span class="params"><span class="function">                              )</span></span>;</span><br><span class="line">Eigen::Matrix3d rotation = quaternion.<span class="built_in">matrix</span>();</span><br></pre></td></tr></table></figure></p>
<h2 id="平移"><a href="#平移" class="headerlink" title="平移"></a>平移</h2><p>采用Eigen标准构造原则，构造示例如下：<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Translation&lt;<span class="keyword">float</span>,<span class="number">2</span>&gt;(tx, ty)</span><br><span class="line">Translation&lt;<span class="keyword">float</span>,<span class="number">3</span>&gt;(tx, ty, tz)</span><br><span class="line">Translation&lt;<span class="keyword">float</span>,N&gt;(s)</span><br><span class="line">Translation&lt;<span class="keyword">float</span>,N&gt;(vecN)</span><br></pre></td></tr></table></figure><br>多个平移合并用乘号而不是加号，需要注意。和旋转相比，它的成员函数也相对少一些:</p>
<ul>
<li><p>x():获取平移的x分量(可修改)</p>
</li>
<li><p>y():获取平移的y分量(可修改)</p>
</li>
<li><p>z():获取平移的z分量(可修改)，注意，千万不要对一个二维的Translation获取z分量，否则直接会运行报错</p>
</li>
<li><p>vector()&amp;.translation():返回当前平移的向量表示(可修改)，可以索引[]获取各分量</p>
</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Translation2d <span class="title">t1</span><span class="params">(<span class="number">1</span>,<span class="number">4</span>)</span></span>;</span><br><span class="line"><span class="function">Translation2d <span class="title">t2</span><span class="params">(<span class="number">2</span>,<span class="number">7</span>)</span></span>;</span><br><span class="line">Translation2d t3;</span><br><span class="line">t3=t1*t2;</span><br><span class="line">cout&lt;&lt;t3.<span class="built_in">translation</span>()&lt;&lt;endl;</span><br></pre></td></tr></table></figure>
<p>参考：<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/wokaowokaowokao12345/article/details/47375427">C++ Eigen库计算矩阵特征值及特征向量</a><br><a target="_blank" rel="noopener" href="http://eigen.tuxfamily.org/dox/AsciiQuickReference.txt">Eigen函数与Matlab对应关系</a></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/09/14/ROS/ROS%20Kinetic%E7%9F%A5%E8%AF%86/sudo%20rosdep%20init%20%E5%92%8C%20rosdep%20update/">彻底解决 sudo rosdep init 和 rosdep update失败问题</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-09-14</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/ROS/">ROS</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/ROS/ROS-Kinetic%E7%9F%A5%E8%AF%86/">ROS Kinetic知识</a></span><div class="content"><p>这两个老大难其实都是网络的问题，<code>sudo rosdep init</code>的目的是为了在/etc目录下新建<code>/ros/rosdep/sources.list.d/20-default.list</code>文件。</p>
<p><code>rosdep update</code> 的目的是在<code>/etc/ros/rosdep/source.list.d</code>下放5个文件，分别是base.yaml,gentoo.yaml,osx-homebrew.yaml,python.yaml,ruby.yaml. 但又做了一些配置，所以不是下载文件能解决的。</p>
<h2 id="执行sudo-rosdep-init后报错"><a href="#执行sudo-rosdep-init后报错" class="headerlink" title="执行sudo rosdep init后报错"></a>执行<code>sudo rosdep init</code>后报错</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ERROR: cannot download default sources list from:</span><br><span class="line">https://raw.githubusercontent.com/ros/rosdistro/master/rosdep/sources.list.d/20-default.list Website may be down</span><br></pre></td></tr></table></figure>
<p>这个问题非常棘手，可能的解决方法是:<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#打开hosts文件</span></span><br><span class="line">sudo gedit /etc/hosts</span><br><span class="line"><span class="comment">#在文件末尾添加</span></span><br><span class="line">151.101.84.133  raw.githubusercontent.com</span><br><span class="line"><span class="comment">#保存后退出再尝试</span></span><br><span class="line">rosdep update</span><br></pre></td></tr></table></figure></p>
<p>如果这招还是不行，从网上直接下载这个文件，然后放到<code>/etc/ros/rosdep/sources.list.d</code></p>
<h2 id="rosdep-update-报错"><a href="#rosdep-update-报错" class="headerlink" title="rosdep update 报错"></a>rosdep update 报错</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">reading <span class="keyword">in</span> sources list data from /etc/ros/rosdep/sources.list.d</span><br><span class="line">ERROR: unable to process <span class="built_in">source</span></span><br></pre></td></tr></table></figure>
<p>解决办法：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">sudo gedit /etc/resolv.conf</span><br><span class="line"></span><br><span class="line"><span class="comment"># 将原有的nameserver这一行注释，并添加以下两行：</span></span><br><span class="line"></span><br><span class="line">nameserver 8.8.8.8 <span class="comment">#google域名服务器</span></span><br><span class="line"></span><br><span class="line">nameserver 8.8.4.4 <span class="comment">#google域名服务器</span></span><br><span class="line"></span><br><span class="line">sudo  apt-get update</span><br><span class="line"></span><br><span class="line">rosdep update</span><br></pre></td></tr></table></figure></p>
<p>如果还是不行，到<code>https://github.com/ros/rosdistro/tree/master/rosdep</code>下载所需文件，然后放到目录<code>/etc/ros/rosdep/source.list.d</code>，还没完，再做下面修改</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sudo gedit /usr/lib/python2.7/dist-packages/rosdep2/sources_list.py</span><br><span class="line"><span class="comment"># 将其中的资源路径改为离线路径</span></span><br><span class="line">DEFAULT_SOURCES_LIST_URL = <span class="string">&#x27;file:/etc/ros/rosdep/sources.list.d/20-default.list&#x27;</span></span><br><span class="line"></span><br><span class="line">sudo gedit /usr/lib/python2.7/dist-packages/rosdep2/rep3.py</span><br><span class="line">REP3_TARGETS_URL = <span class="string">&#x27;file:/etc/ros/rosdep/sources.list.d/rosdistro-master/releases/targets.yaml&#x27;</span></span><br><span class="line"></span><br><span class="line">sudo gedit /usr/lib/python2.7/dist-packages/rosdistro/__init__.py</span><br><span class="line">DEFAULT_INDEX_URL = <span class="string">&#x27;file:/etc/ros/rosdep/sources.list.d/rosdistro-master/index-v4.yaml&#x27;</span></span><br></pre></td></tr></table></figure>
<p>启动新终端，再次执行rosdep update</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/09/14/SLAM%E5%B7%A5%E5%85%B7/gtsam/">gtsam</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-09-14</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/SLAM%E5%B7%A5%E5%85%B7/">SLAM工具</a></span><div class="content"><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>下载gtsam源码:  <code>git clone https://bitbucket.org/gtborg/gtsam.git</code></p>
<p>依赖:<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Boost &gt;= 1.43 (Ubuntu: sudo apt-get install libboost-all-dev)</span><br><span class="line">CMake &gt;= 3.0 (Ubuntu: sudo apt-get install cmake)</span><br></pre></td></tr></table></figure></p>
<p>安装可选的依赖:</p>
<ul>
<li>Intel Threaded Building Blocks (TBB)</li>
</ul>
<p><code>sudo apt-get install libtbb-dev</code></p>
<ul>
<li>Intel Math Kernel Library (MKL)</li>
</ul>
<p><code>https://software.intel.com/content/www/us/en/develop/articles/installing-intel-free-libs-and-python-apt-repo.html</code></p>
<h3 id="编译"><a href="#编译" class="headerlink" title="编译"></a>编译</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">mkdir build</span><br><span class="line"><span class="built_in">cd</span> build</span><br><span class="line">cmake ..</span><br><span class="line">make install</span><br></pre></td></tr></table></figure></div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/09/13/Linux%E5%9F%BA%E7%A1%80/curl%E5%91%BD%E4%BB%A4%E8%AF%A6%E8%A7%A3/">curl命令详解</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-09-13</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Linux%E5%9F%BA%E7%A1%80/">Linux基础</a></span><div class="content"><p>curl是一个利用URL规则在命令行下工作的文件传输工具，可以说是一款很强大的http命令行工具。它支持文件的上传和下载，是综合传输工具，但按传统，习惯称url为下载工具。</p>
<p><code>curl http://www.linux.com</code>执行后， www.linux.com 的html就会显示在屏幕上了，相当于下载之后再cat命令</p>
<p>使用linux的重定向功能保存<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl http://www.linux.com &gt;&gt; linux.html</span><br></pre></td></tr></table></figure></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/09/13/Linux%E5%9F%BA%E7%A1%80/ubuntu%2018.04%E5%AE%89%E8%A3%85N%E5%8D%A1%E9%A9%B1%E5%8A%A8/">ubuntu 18.04安装N卡驱动</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-09-13</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/Linux%E5%9F%BA%E7%A1%80/">Linux基础</a></span><div class="content"><p>电脑装好好，启动一直失败，报错<code>failed to start User Manager for UID 121</code>，连文本界面都进不去，后来才知道是ubuntu下缺少显卡驱动</p>
<p>先完全卸载之前安装的显卡驱动</p>
<p>ppa源文件卸载：<code>sudo apt-get remove --purge nvidia*</code></p>
<p>runfile源文件卸载：<code>sudo ./NVIDIA-Linux-x86_64-384.59.run --uninstall</code></p>
<p>最简单的安装方法—-ppa源驱动安装</p>
<p>先查询电脑最适合的显卡驱动版本，命令 <code>ubuntu-drivers devices</code>，这个命令不仅适用于显卡<br><img src="https://i.loli.net/2021/09/14/Lb1IQYFmkvJsa4U.png" alt=""></p>
<p>最佳显卡驱动版本为 nvidia-driver-435， 用命令行进行安装<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo add-apt-repository ppa:graphics-drivers/ppa</span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install nvidia-driver-435 <span class="comment">#此处数字要对应上面查询到的版本号</span></span><br><span class="line">sudo apt-get install mesa-common-dev</span><br></pre></td></tr></table></figure><br>如果前面没有禁用secure boot，则在安装过程中会提示设置一个密码，在重启时需要输入密码验证以禁用secure boot，重启后会出现蓝屏，这时候不能直接选择continue, 而应该按下按键，选择Enroll MOK, 确认后在下一个选项中选择continue,接着输入安装驱动时设置的密码，开机。</p>
<p>安装完成后重启，重启后在终端验证<code>nvidia-smi</code>。 若出现GPU列表，则安装成功</p>
</div><hr></div><nav id="pagination"><div class="pagination"><span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/45/">45</a><a class="extend next" rel="next" href="/page/2/">Next &gt;&gt;</a></div></nav></div></div><footer class="footer-bg" style="background-image: url(https://i.loli.net/2021/07/13/RCLw5Bx8aFPN74b.jpg)"><div class="layout" id="footer"><div class="copyright">&copy;2018 - 2021 By Charon Cheung</div><div class="framework-info"><span>Driven - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_site_uv"><i class="fa fa-user"></i><span id="busuanzi_value_site_uv"></span><span></span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_site_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.6.1"></script><script src="/js/fancybox.js?version=1.6.1"></script><script src="/js/sidebar.js?version=1.6.1"></script><script src="/js/copy.js?version=1.6.1"></script><script src="/js/fireworks.js?version=1.6.1"></script><script src="/js/transition.js?version=1.6.1"></script><script src="/js/scroll.js?version=1.6.1"></script><script src="/js/head.js?version=1.6.1"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
    processEscapes: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
  },
  CommonHTML: {
    linebreaks: { automatic: true, width: "90% container" }
  },
  "HTML-CSS": { 
    linebreaks: { automatic: true, width: "90% container" }
  },
  "SVG": { 
    linebreaks: { automatic: true, width: "90% container" }
  }
});
</script><script type="text/x-mathjax-config">MathJax.Hub.Queue(function() {
  var all = MathJax.Hub.getAllJax(), i;
  for (i=0; i < all.length; i += 1) {
    all[i].SourceElement().parentNode.className += ' has-jax';
  }
});
</script><script src="https://cdn.bootcss.com/mathjax/2.7.2/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script>if(/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
}</script></body></html>