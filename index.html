<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content=""><meta name="keywords" content=""><meta name="author" content="Charon Cheung"><meta name="copyright" content="Charon Cheung"><title>If you wish for peace, prepare for war | 沉默杀手</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.6.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.6.1"><link rel="dns-prefetch" href="https://cdn.staticfile.org"><link rel="dns-prefetch" href="https://cdn.bootcss.com"><link rel="dns-prefetch" href="https://creativecommons.org"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  }
} </script><meta name="generator" content="Hexo 5.4.0"></head><body><canvas class="fireworks"></canvas><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar"><div class="author-info"><div class="author-info__avatar text-center"><img src="https://s2.loli.net/2022/02/17/HQaCXUBn64zsMIL.png"></div><div class="author-info__name text-center">Charon Cheung</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">559</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">5</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">49</span></a></div></div></div><nav id="nav" style="background-image: url(https://s2.loli.net/2024/11/12/x1aqcwUG3XDiskN.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">沉默杀手</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus"><a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span></div><div id="site-info"><div id="site-title">沉默杀手</div><div id="site-sub-title">If you wish for peace, prepare for war</div></div></nav><div id="content-outer"><div class="layout" id="content-inner"><div class="recent-post-item article-container"><a class="article-title" href="/2025/09/01/ROS/ROS2/ROS2%E4%B8%AD%E7%9A%84%E4%BB%A3%E4%BB%B7%E5%9C%B0%E5%9B%BE/">ROS2中的代价地图</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2025-09-01</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/ROS/">ROS</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/ROS/ROS2/">ROS2</a></span><div class="content"><p>代价地图是在 <code>planner_server</code> 和 <code>controller_server</code>中初始化的。</p>
<h3 id="清除代价地图"><a href="#清除代价地图" class="headerlink" title="清除代价地图"></a>清除代价地图</h3><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Action</span> <span class="attr">ID</span>=<span class="string">&quot;ClearEntireCostmap&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">input_port</span> <span class="attr">name</span>=<span class="string">&quot;service_name&quot;</span>&gt;</span>Service name<span class="tag">&lt;/<span class="name">input_port</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">input_port</span> <span class="attr">name</span>=<span class="string">&quot;server_timeout&quot;</span>&gt;</span>Server timeout<span class="tag">&lt;/<span class="name">input_port</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Action</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">Action</span> <span class="attr">ID</span>=<span class="string">&quot;ClearCostmapExceptRegion&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">input_port</span> <span class="attr">name</span>=<span class="string">&quot;service_name&quot;</span>&gt;</span>Service name<span class="tag">&lt;/<span class="name">input_port</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">input_port</span> <span class="attr">name</span>=<span class="string">&quot;server_timeout&quot;</span>&gt;</span>Server timeout<span class="tag">&lt;/<span class="name">input_port</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">input_port</span> <span class="attr">name</span>=<span class="string">&quot;reset_distance&quot;</span>&gt;</span>Distance from the robot above which obstacles are cleared<span class="tag">&lt;/<span class="name">input_port</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Action</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">Action</span> <span class="attr">ID</span>=<span class="string">&quot;ClearCostmapAroundRobot&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">input_port</span> <span class="attr">name</span>=<span class="string">&quot;service_name&quot;</span>&gt;</span>Service name<span class="tag">&lt;/<span class="name">input_port</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">input_port</span> <span class="attr">name</span>=<span class="string">&quot;server_timeout&quot;</span>&gt;</span>Server timeout<span class="tag">&lt;/<span class="name">input_port</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">input_port</span> <span class="attr">name</span>=<span class="string">&quot;reset_distance&quot;</span>&gt;</span>Distance from the robot under which obstacles are cleared<span class="tag">&lt;/<span class="name">input_port</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">Action</span>&gt;</span></span><br></pre></td></tr></table></figure>
<p>行为树节点部分在<code>clear_costmap_service.cpp</code>，三个类都继承了<code>BtServiceNode</code></p>
<p>服务端在 <code>clear_costmap_service.cpp</code>， 这里创建了service，编译为 <code>libnav2_costmap_2d_core.so</code>.  构造函数部分可以看到三个service的创建及其名称<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">ClearCostmapService::<span class="built_in">ClearCostmapService</span>(</span><br><span class="line">  <span class="keyword">const</span> nav2_util::LifecycleNode::WeakPtr &amp; parent,</span><br><span class="line">  Costmap2DROS &amp; costmap)</span><br><span class="line">: <span class="built_in">costmap_</span>(costmap)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">auto</span> node = parent.<span class="built_in">lock</span>();</span><br><span class="line">  logger_ = node-&gt;<span class="built_in">get_logger</span>();</span><br><span class="line">  reset_value_ = costmap_.<span class="built_in">getCostmap</span>()-&gt;<span class="built_in">getDefaultValue</span>();</span><br><span class="line"></span><br><span class="line">  clear_except_service_ = node-&gt;create_service&lt;ClearExceptRegion&gt;(</span><br><span class="line">    <span class="string">&quot;clear_except_&quot;</span> + costmap_.<span class="built_in">getName</span>(),</span><br><span class="line">    std::<span class="built_in">bind</span>(</span><br><span class="line">      &amp;ClearCostmapService::clearExceptRegionCallback, <span class="keyword">this</span>,</span><br><span class="line">      std::placeholders::_1, std::placeholders::_2, std::placeholders::_3));</span><br><span class="line"></span><br><span class="line">  clear_around_service_ = node-&gt;create_service&lt;ClearAroundRobot&gt;(</span><br><span class="line">    <span class="string">&quot;clear_around_&quot;</span> + costmap.<span class="built_in">getName</span>(),</span><br><span class="line">    std::<span class="built_in">bind</span>(</span><br><span class="line">      &amp;ClearCostmapService::clearAroundRobotCallback, <span class="keyword">this</span>,</span><br><span class="line">      std::placeholders::_1, std::placeholders::_2, std::placeholders::_3));</span><br><span class="line"></span><br><span class="line">  clear_entire_service_ = node-&gt;create_service&lt;ClearEntirely&gt;(</span><br><span class="line">    <span class="string">&quot;clear_entirely_&quot;</span> + costmap_.<span class="built_in">getName</span>(),</span><br><span class="line">    std::<span class="built_in">bind</span>(</span><br><span class="line">      &amp;ClearCostmapService::clearEntireCallback, <span class="keyword">this</span>,</span><br><span class="line">      std::placeholders::_1, std::placeholders::_2, std::placeholders::_3));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><br>比如名称可以是  <code>clear_around_local_costmap</code></p>
<p>对应3个service<br><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">/local_costmap/clear_around_local_costmap</span><br><span class="line">/local_costmap/clear_entirely_local_costmap</span><br><span class="line">/local_costmap/clear_except_local_costmap</span><br></pre></td></tr></table></figure></p>
<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><p>编译<code>nav2_costmap_2d</code>后，直接运行<code>ros2 run nav2_costmap_2d nav2_costmap</code>，结果报错<br><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[pluginlib.ClassLoader]: Skipped loading plugin with error: XML Document <span class="string">&#x27;/home/user/project/install/nav2_costmap_2d/share/nav2_costmap_2d/costmap_plugins.xml&#x27;</span> has <span class="keyword">no</span> Root Element. This likely means the XML is malformed <span class="keyword">or</span> missing..</span><br></pre></td></tr></table></figure></p>
<hr>
<p>如果行为树有节点是Nav2的客户端，在服务端没启动时，服务不可用，行为树运行时会直接报错，不会运行任何节点。</p>
<p>如果没启动服务端，客户端发起请求时会报错<br><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[ERROR] [<span class="number">1754535646.216247848</span>] [nav2_node]: <span class="string">&quot;global_costmap/clear_entirely_global_costmap&quot;</span> service server <span class="keyword">not</span> available after waiting <span class="keyword">for</span> <span class="number">1.00</span>s</span><br><span class="line">[nav2_node-<span class="number">1</span>] terminate called after throwing an instance of <span class="string">&#x27;std::length_error&#x27;</span></span><br><span class="line">[nav2_node-<span class="number">1</span>]   what():  basic_string::_M_create</span><br></pre></td></tr></table></figure><br>可以把 <code>BtServiceNode</code>构造函数的<code>throw</code>一行删掉，这样即使没有服务端，也不会报错</p>
<hr>
<p><img src="https://s2.loli.net/2025/08/07/I3eETmKJLbslD85.png" alt=".png"></p>
<p>Action和<code>service_name</code>不符合，加载行为树会报错<br><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">what():  could <span class="keyword">not</span> create client: create_client() called <span class="keyword">for</span> existing request topic name rq/global_costmap/clear_entirely_global_costmapRequest with incompatible type navit_msgs::srv::dds<span class="number">_</span>::ClearEntireCostmap_Request<span class="number">_</span>, at ./src/rmw_client.cpp:<span class="number">165</span>, at ./src/rcl/client.c:<span class="number">146</span></span><br></pre></td></tr></table></figure></p>
<hr>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2025/09/01/ROS/ROS2/Nav2%E4%B8%AD%E7%9A%84map_server/">Nav2中的map_server</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2025-09-01</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/ROS/">ROS</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/ROS/ROS2/">ROS2</a></span><div class="content"><p>又是和ROS1的有所不同</p>
<p>先执行：<code>ros2 run nav2_map_server map_server --ros-args --param yaml_filename:=map/fishbot_map.yaml</code></p>
<p>再打开rviz2，把设置都改好<br><img src="https://s2.loli.net/2025/08/05/hQRLKowY81y9tV4.png" alt="截图 2025-08-05 14-42-41.png"></p>
<p>再手动激活和配置节点<br><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ros2 lifecycle set /map_server configure  </span><br><span class="line">ros2 lifecycle set /map_server activate</span><br></pre></td></tr></table></figure><br>这样才能正常显示地图<br>在加载map成功后，如果再加载costmap，对应的Rviz里的 <code>Durability Policy</code> 可以不改为 <code>Transient Local</code></p>
<p>跟ROS1有所不同，不会一直发布<code>/map</code>话题。而且<code>/map</code>不会显示所有地图数据，会用<code>- &#39;...&#39;</code>表示，估计是开发者觉得显示一大堆地图数据没有意义。</p>
<p>也可以在运行时使用<code>load_map</code>服务更改地图</p>
<hr>
<p><code>Map Server</code>是一个可组合的 ROS2 节点。默认情况下，有一个<code>map_server</code>可执行文件来实例化这些节点之一，但如果需要，也可以将多个地图服务器节点组合到一个进程中。</p>
<p>Nav2 使用 ROS2 参数机制来获取要使用的 YAML 文件名。这实际上引入了一个间接层来获取地图 yaml 文件名。例如，对于一个名为“map_server”的节点，参数文件看起来是这样的：</p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">map_server:</span><br><span class="line">    ros__parameters:</span><br><span class="line">        yaml_filename: <span class="string">&quot;map.yaml&quot;</span></span><br></pre></td></tr></table></figure>
<p>也可以在一个进程中运行多个地图服务器节点，此时参数文件会按节点名称分隔参数，例如：<br><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># combined_params.yaml</span></span><br><span class="line">map_server1:</span><br><span class="line">    ros__parameters:</span><br><span class="line">        yaml_filename: <span class="string">&quot;some_map.yaml&quot;</span></span><br><span class="line"></span><br><span class="line">map_server2:</span><br><span class="line">    ros__parameters:</span><br><span class="line">        yaml_filename: <span class="string">&quot;another_map.yaml&quot;</span></span><br></pre></td></tr></table></figure></p>
<p>然后，使用包含两个节点参数的参数文件来启动该进程：<code>process_with_multiple_map_servers  __params:=combined_params.yaml</code></p>
<h3 id="保存地图"><a href="#保存地图" class="headerlink" title="保存地图"></a>保存地图</h3><p><code>ros2 run nav2_map_server map_saver_cli [arguments] [--ros-args ROS remapping args]</code></p>
<p>比如：<code>ros2   run   nav2_map_server   map_saver_cli   -f   test</code></p>
<h3 id="两个-service"><a href="#两个-service" class="headerlink" title="两个 service"></a>两个 service</h3><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ros2 service call /map_server/load_map nav2_msgs/srv/LoadMap <span class="string">&quot;&#123;map_url: /ros/maps/map.yaml&#125;&quot;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ros2 service call /map_saver/save_map nav2_msgs/srv/SaveMap <span class="string">&quot;&#123;map_topic: map, map_url: my_map, image_format: pgm, map_mode: trinary, free_thresh: 0.25, occupied_thresh: 0.65&#125;&quot;</span></span><br></pre></td></tr></table></figure>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2025/09/01/ROS/ROS2/ROS2%E4%B8%AD%E7%9A%84%E5%8F%82%E6%95%B0/">ROS2中的参数</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2025-09-01</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/ROS/">ROS</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/ROS/ROS2/">ROS2</a></span><div class="content"><p>ROS2 中没有一个像ROS 1 那样的集中式参数服务器。<strong>ROS 2 的参数是与每个节点绑定的，每个节点都有自己的参数管理系统</strong>。也就是说 <strong>节点私有:</strong> 参数与节点相关联，而不是全局共享。节点可以声明、获取和更新自己的参数，也可以通过客户端库（<code>SyncParametersClient</code>或<code>AsyncParametersClient</code>）访问和修改其他节点的参数，从而实现参数共享。参数可以在节点运行时动态地获取和更新，方便配置和调试.</p>
<p>ROS 2 提供了参数接口，可以用于在节点之间共享参数，实现参数的动态更新和访问。</p>
<ul>
<li>ros2 param list</li>
<li>ros2 param describe</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ros2 param describe /turtlesim background_r</span><br><span class="line">Parameter name: background_r</span><br><span class="line">  Type: <span class="built_in">integer</span></span><br><span class="line">  Description: Red channel of the background color</span><br><span class="line">  Constraints:</span><br><span class="line">    Min value: 0</span><br><span class="line">    Max value: 255</span><br><span class="line">    Step: 1</span><br></pre></td></tr></table></figure>
<ul>
<li><code>ros2 param get node_name parameter_name</code></li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ros2 param get /turtlesim background_r</span><br><span class="line">Integer value is: 69</span><br></pre></td></tr></table></figure>
<ul>
<li><p>ros2 param set (省略)</p>
</li>
<li><p>ros2 run + param</p>
</li>
<li><p>ros2 run <package_name> <executable_name> —ros-args —params-file <file_name></p>
</li>
</ul>
<hr>
<ul>
<li>设置参数</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">node-&gt;<span class="built_in">declare_parameter</span>(<span class="string">&quot;my_string_param&quot;</span>, <span class="string">&quot;default_value&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// nav2_util里实现了先判断参数是否存在，再设置</span></span><br><span class="line"><span class="function"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> NodeT&gt;</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">declare_parameter_if_not_declared</span><span class="params">(</span></span></span><br><span class="line"><span class="params"><span class="function">  NodeT node,</span></span></span><br><span class="line"><span class="params"><span class="function">  <span class="keyword">const</span> std::string &amp; parameter_name,</span></span></span><br><span class="line"><span class="params"><span class="function">  <span class="keyword">const</span> rclcpp::ParameterValue &amp; default_value,</span></span></span><br><span class="line"><span class="params"><span class="function">  <span class="keyword">const</span> ParameterDescriptor &amp; parameter_descriptor = ParameterDescriptor())</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!node-&gt;<span class="built_in">has_parameter</span>(parameter_name)) &#123;</span><br><span class="line">    node-&gt;<span class="built_in">declare_parameter</span>(parameter_name, default_value, parameter_descriptor);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>获得参数</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Retrieve the parameter</span></span><br><span class="line">rclcpp::Parameter param_obj = <span class="keyword">this</span>-&gt;<span class="built_in">get_parameter</span>(<span class="string">&quot;my_string_param&quot;</span>);</span><br><span class="line"><span class="built_in">printf</span>(<span class="string">&quot;type name: %s\n&quot;</span>, param_obj.<span class="built_in">get_type_name</span>().<span class="built_in">c_str</span>()  );</span><br><span class="line"><span class="comment">// Extract the value</span></span><br><span class="line">std::string param_value = param_obj.<span class="built_in">as_string</span>();</span><br><span class="line">std::vector&lt;std::string&gt; param_value = param_obj.<span class="built_in">as_string_array</span>();</span><br></pre></td></tr></table></figure>
<p>但是有时候参数类型不一定就是<code>string</code>，可能是<code>string</code>的vector，可以用<code>get_type_name</code>查看类型。</p>
<p>如果是<code>vector&lt;std::string&gt;</code>，其size仅为1，实际不如就让类型为string，这应当是ROS2的一个缺陷。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> ParameterT &gt;</span><br><span class="line"><span class="keyword">bool</span> rclcpp::Node::<span class="built_in">get_parameter_or</span>(<span class="keyword">const</span> std::string&amp;  name,</span><br><span class="line">   ParameterT&amp;  value,  <span class="keyword">const</span> ParameterT&amp;  alternative_value </span><br><span class="line">                                   ) <span class="keyword">const</span></span><br></pre></td></tr></table></figure>
<p>获取参数值，如果未设置，则获取<code>alternative_value</code>，并将其赋给<code>value</code>。</p>
<ul>
<li>删除参数</li>
</ul>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>-&gt;<span class="built_in">remove_parameter</span>(<span class="string">&quot;example_param&quot;</span>);</span><br></pre></td></tr></table></figure>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2025/09/01/ROS/ROS2/ROS2%E7%9A%84%E5%87%A0%E4%B8%AA%E5%B8%B8%E8%A7%81%E5%9F%BA%E6%9C%AC%E9%97%AE%E9%A2%98/">ROS2的几个常见基本问题</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2025-09-01</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/ROS/">ROS</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/ROS/ROS2/">ROS2</a></span><div class="content"><h2 id="ROS2-ConnectionResetError-Errno-104-Connection-reset-by-peer"><a href="#ROS2-ConnectionResetError-Errno-104-Connection-reset-by-peer" class="headerlink" title="ROS2 ConnectionResetError: [Errno 104] Connection reset by peer"></a>ROS2 ConnectionResetError: [Errno 104] Connection reset by peer</h2><p>执行<code>ros2 node list</code>遇到的错误，有一大堆信息，这是最后一句。按如下步骤解决:</p>
<p><em>a</em>. 检查守护进程是否确实在运行</p>
<p><code>ros2 daemon status</code> 或者 <code>systemctl status ros2-daemon.service</code></p>
<p><em>b</em>. 重新启动守护进程</p>
<p>如果守护进程没有运行，尝试启动它: <code>ros2 daemon start</code></p>
<p>然后再次检查状态: <code>ros2 daemon status</code>。现在<code>ros2 node list</code>正常了。</p>
<h2 id="未知节点在运行"><a href="#未知节点在运行" class="headerlink" title="未知节点在运行"></a>未知节点在运行</h2><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">/controller_manager_lift</span><br><span class="line">/diff_chassis_driver</span><br><span class="line">/fault_service_node</span><br><span class="line">/iot</span><br><span class="line">/task_mgr</span><br></pre></td></tr></table></figure>
<p>以上是<code>ros2 node list</code>查看到的结果，但是用<code>ps aux</code>都看不到。由于不存在<code>ros2 node ping</code>，不确定这几个节点到底是不是存在。</p>
<p>这几个节点应该是其他机器上的。需要在<code>.bashrc</code>里加入<code>export ROS_DOMAIN_ID=77</code></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2025/09/01/ROS/ROS2/ROS2%E4%B8%AD%E7%9A%84Action%E5%92%8CService/">ROS2中的Action和Service</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2025-09-01</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/ROS/">ROS</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/ROS/ROS2/">ROS2</a></span><div class="content"><h3 id="action"><a href="#action" class="headerlink" title="action"></a>action</h3><ul>
<li><p>ros2  action  list  -t</p>
</li>
<li><p>ros2 action info /compute_path_to_pose</p>
</li>
</ul>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Action: <span class="regexp">/compute_path_to_pose</span></span><br><span class="line"><span class="regexp">Action clients: 0</span></span><br><span class="line"><span class="regexp">Action servers: 1</span></span><br><span class="line"><span class="regexp">    /plann</span>er_server</span><br></pre></td></tr></table></figure>
<ul>
<li><p>ros2 action type  /compute_path_to_pose<br>结果是 <code>nav2_msgs/action/ComputePathToPose</code></p>
</li>
<li><p>ros2 interface show nav2_msgs/action/ComputePathToPose</p>
</li>
</ul>
<p>结果是 action 文件的详细信息</p>
<ul>
<li>ros2 action send_goal</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">nvidia<span class="meta">@ubuntu</span>:~$ ros2 <span class="class"><span class="keyword">interface</span> <span class="title">show</span> <span class="title">turtlesim</span>/<span class="title">action</span>/<span class="title">RotateAbsolute</span>.<span class="title">action</span></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"># <span class="title">The</span> <span class="title">desired</span> <span class="title">heading</span> <span class="title">in</span> <span class="title">radians</span></span></span><br><span class="line"><span class="class"><span class="title">float32</span> <span class="title">theta</span></span></span><br><span class="line"><span class="class">---</span></span><br><span class="line"><span class="class"># <span class="title">The</span> <span class="title">angular</span> <span class="title">displacement</span> <span class="title">in</span> <span class="title">radians</span> <span class="title">to</span> <span class="title">the</span> <span class="title">starting</span> <span class="title">position</span></span></span><br><span class="line"><span class="class"><span class="title">float32</span> <span class="title">delta</span></span></span><br><span class="line"><span class="class">---</span></span><br><span class="line"><span class="class"># <span class="title">The</span> <span class="title">remaining</span> <span class="title">rotation</span> <span class="title">in</span> <span class="title">radians</span></span></span><br><span class="line"><span class="class"><span class="title">float32</span> <span class="title">remaining</span></span></span><br></pre></td></tr></table></figure>
<p>这三项依次是目标，结果，反馈</p>
<ul>
<li>发送操作目标:  <code>ros2 action send_goal &lt;action_name&gt; &lt;action_type&gt; &lt;values&gt;</code></li>
</ul>
<p>比如 <code>ros2 action send_goal /turtle1/rotate_absolute turtlesim/action/RotateAbsolute &quot;&#123;theta: 1.57&#125;&quot;</code></p>
<figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">nvidia@ubuntu:~$ ros2 action send_goal /turtle1/rotate_absolute turtlesim/action/RotateAbsolute <span class="string">&quot;&#123;theta: 1.57&#125;&quot;</span></span><br><span class="line">Waiting <span class="keyword">for</span> an action server to become available...</span><br><span class="line">Sending goal:</span><br><span class="line">theta: <span class="number">1.57</span></span><br><span class="line">Goal accepted with ID: <span class="number">5</span>cd8eb561348477abbb532fc816ce792</span><br><span class="line"></span><br><span class="line">Result:</span><br><span class="line">delta: <span class="number">1.5680029392242432</span></span><br><span class="line"></span><br><span class="line">Goal finished with status: SUCCEEDED</span><br></pre></td></tr></table></figure>
<p>当然结果与目标有一定误差</p>
<p>要查看此目标的反馈，请在上次运行的命令中添加 <code>--feedback</code>，会看到连续的打印输出，将继续收到反馈，直到目标完成。</p>
<h2 id="interface"><a href="#interface" class="headerlink" title="interface"></a>interface</h2><ul>
<li>ros2 interface list</li>
</ul>
<p>分类显示消息、动作、服务的所有类型</p>
<ul>
<li>ros2 interface package pkg_name</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">user<span class="meta">@robot</span>:~$ ros2 <span class="class"><span class="keyword">interface</span> <span class="title">package</span> <span class="title">action_msgs</span></span></span><br><span class="line"><span class="class"><span class="title">action_msgs</span>/<span class="title">srv</span>/<span class="title">CancelGoal</span></span></span><br><span class="line"><span class="class"><span class="title">action_msgs</span>/<span class="title">msg</span>/<span class="title">GoalInfo</span></span></span><br><span class="line"><span class="class"><span class="title">action_msgs</span>/<span class="title">msg</span>/<span class="title">GoalStatus</span></span></span><br><span class="line"><span class="class"><span class="title">action_msgs</span>/<span class="title">msg</span>/<span class="title">GoalStatusArray</span></span></span><br></pre></td></tr></table></figure>
<p>获知某个消息类型是谁在用，可以这样查<br><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">user<span class="meta">@robot</span>:~$ ros2 <span class="class"><span class="keyword">interface</span> <span class="title">packages</span> | <span class="title">grep</span> <span class="title">pendulum_msgs</span></span></span><br><span class="line"><span class="class"><span class="title">pendulum_msgs</span></span></span><br><span class="line"><span class="class"><span class="title">user</span>@<span class="title">robot</span>:~$ <span class="title">ros2</span> <span class="title">interface</span> <span class="title">package</span> <span class="title">pendulum_msgs</span></span></span><br><span class="line"><span class="class"><span class="title">pendulum_msgs</span>/<span class="title">msg</span>/<span class="title">RttestResults</span></span></span><br><span class="line"><span class="class"><span class="title">pendulum_msgs</span>/<span class="title">msg</span>/<span class="title">JointState</span></span></span><br><span class="line"><span class="class"><span class="title">pendulum_msgs</span>/<span class="title">msg</span>/<span class="title">JointCommand</span></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"><span class="title">user</span>@<span class="title">robot</span>:~$ <span class="title">ros2</span> <span class="title">topic</span> <span class="title">find</span> <span class="title">pendulum_msgs</span>/<span class="title">msg</span>/<span class="title">RttestResults</span></span></span><br></pre></td></tr></table></figure></p>
<ul>
<li>显示消息的成员</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">user<span class="meta">@robot</span>:~$ ros2 <span class="class"><span class="keyword">interface</span> <span class="title">proto</span> <span class="title">std_msgs</span>/<span class="title">msg</span>/<span class="title">String</span></span></span><br><span class="line"><span class="class">&quot;<span class="title">data</span>: &#x27;&#x27;&quot;</span></span><br></pre></td></tr></table></figure>
<h2 id="service"><a href="#service" class="headerlink" title="service"></a>service</h2><ul>
<li>ros2 service type</li>
</ul>
<p>可以看到服务的定义。</p>
<ul>
<li>ros2 service find</li>
</ul>
<p>找出指定类型的所有服务</p>
<ul>
<li><p>ros2 service find std_srvs/srv/Empty</p>
</li>
<li><p>ros2 interface show</p>
</li>
</ul>
<p>显示服务的定义</p>
<ul>
<li>call命令比ROS1复杂了，需要指明service类型:  <code>ros2 service call service_name service_type</code></li>
</ul>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2025/08/24/%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7/Git%E4%B8%8D%E5%B8%B8%E7%94%A8%E7%9A%84%E5%91%BD%E4%BB%A4/">Git不常用的命令</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2025-08-24</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7/">常用工具</a></span><div class="content"><h2 id="查看当前用户名和邮箱"><a href="#查看当前用户名和邮箱" class="headerlink" title=" 查看当前用户名和邮箱 "></a><center> 查看当前用户名和邮箱 </center></h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config user.name</span><br><span class="line">git config user.email</span><br></pre></td></tr></table></figure>
<p>修改用户名和地址，不加global只能生效一次<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.name <span class="string">&quot;your name&quot;</span></span><br><span class="line">git config --global user.email <span class="string">&quot;your email&quot;</span></span><br></pre></td></tr></table></figure></p>
<h2 id="打标签"><a href="#打标签" class="headerlink" title="打标签"></a>打标签</h2><p>Git 中的tag指向一次commit的id，通常用来给开发分支做一个标记，如标记一个版本号。<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git tag -a v1.01 -m <span class="string">&quot;Relase version 1.01&quot;</span></span><br></pre></td></tr></table></figure><br>注解：git tag 是打标签的命令，-a 是添加标签，其后要跟新标签号，-m 及后面的字符串是对该标签的注释。</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2025/08/24/%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7/Git%20%E9%81%87%E5%88%B0%E7%9A%84%E9%97%AE%E9%A2%98/">Git 遇到的问题</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2025-08-24</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/%E5%B8%B8%E7%94%A8%E5%B7%A5%E5%85%B7/">常用工具</a></span><div class="content"><h3 id="rm-问题"><a href="#rm-问题" class="headerlink" title="rm 问题"></a>rm 问题</h3><p>对git本地仓库，使用<code>rm</code>而不是<code>git rm</code>删除一个文件A后，直接commit 和 push，远程仓库仍然有A。此时已经不能再执行<code>git rm</code>了，所以将删除动作添加到暂存区 <code>git add .</code>，然后再commit 和 push<br><img src="https://s2.loli.net/2024/02/18/nR4oJMcxH2LGOA6.png" alt="操作过程"></p>
<h3 id="branch-diverged"><a href="#branch-diverged" class="headerlink" title="branch diverged"></a>branch diverged</h3><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 执行 git status 的结果</span></span><br><span class="line">On branch master</span><br><span class="line">Your branch and <span class="string">&#x27;origin/master&#x27;</span> have diverged,</span><br><span class="line">and have 5 and 21 different commits each, respectively.</span><br><span class="line">  (use <span class="string">&quot;git pull&quot;</span> to merge the remote branch into yours)</span><br><span class="line"></span><br><span class="line">nothing to commit, working tree clean</span><br></pre></td></tr></table></figure>
<p>这发生在多人可能操作 master 分支的时候，我自己的分支提交完了，切换到master分支，要执行合并时，出现这个问题，并不是文件冲突的问题。按如下方法解决：</p>
<p>如果不需要保留本地的修改，只要执行下面两步：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git fetch origin</span><br><span class="line">git reset --hard origin/master</span><br></pre></td></tr></table></figure><br>当我们在本地提交到远程仓库的时候，如果遇到上述问题，我们可以首先使用如下命令：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">git rebase origin/master</span><br><span class="line">git pull --rebase</span><br><span class="line"><span class="comment"># 提交到远程仓库</span></span><br><span class="line">git push origin master</span><br></pre></td></tr></table></figure></p>
<h3 id="一次合并冲突的解决"><a href="#一次合并冲突的解决" class="headerlink" title="一次合并冲突的解决"></a>一次合并冲突的解决</h3><p>我在自己的分支<code>me</code>开发，主分支比我领先很多。有一次，我从git上下载了主分支的压缩包，然后手动覆盖了一部分文件以更新，这其实是不正确的操作。</p>
<p>第二天我先切换到主分支，更新到最新，然后切换到<code>me</code>分支，提交到远程后，合并主分支，结果出现的冲突比我自己修改的多很多，因为把我昨天手动覆盖的那些也包括了。这种情况下，只能手动解决冲突，但是大部分文件一定是用主分支，如果一个个打开会很麻烦。</p>
<p>用VSCode打开工程，分支管理里会显示文件冲突，对使用主分支版本的文件，右键选择就可以，而且能同时选多个文件。解决完之后，选择暂存文件，之后可以push了。</p>
<h3 id="fatal-无法访问-The-requested-URL-returned-error-502"><a href="#fatal-无法访问-The-requested-URL-returned-error-502" class="headerlink" title="fatal: 无法访问  The requested URL returned error: 502"></a>fatal: 无法访问  The requested URL returned error: 502</h3><p>需要关闭代理软件</p>
<h3 id="remote-error-cannot-lock-ref-‘refs-heads-feat-user’-‘refs-heads-feat-user-interface’-exists-cannot-create-‘refs-heads-feat-user’"><a href="#remote-error-cannot-lock-ref-‘refs-heads-feat-user’-‘refs-heads-feat-user-interface’-exists-cannot-create-‘refs-heads-feat-user’" class="headerlink" title="remote: error: cannot lock ref ‘refs/heads/feat/user’: ‘refs/heads/feat/user/interface’ exists; cannot create ‘refs/heads/feat/user’"></a>remote: error: cannot lock ref ‘refs/heads/feat/user’: ‘refs/heads/feat/user/interface’ exists; cannot create ‘refs/heads/feat/user’</h3><p>push到了不存在的分支</p>
<h3 id="使用VS-Code-git-push报错：Missing-or-invalid-credentials-Error-connect-ECONNREFUSED-run-user-1000-vscode-git-ec01"><a href="#使用VS-Code-git-push报错：Missing-or-invalid-credentials-Error-connect-ECONNREFUSED-run-user-1000-vscode-git-ec01" class="headerlink" title="使用VS Code git push报错：Missing or invalid credentials.Error: connect ECONNREFUSED /run/user/1000/vscode-git-ec01"></a>使用VS Code git push报错：Missing or invalid credentials.Error: connect ECONNREFUSED /run/user/1000/vscode-git-ec01</h3><p><img src="https://s2.loli.net/2025/08/23/ychmo8QtdLuY2GP.png" alt="image.png"></p>
<p>解决：文件 —&gt; 首选项 —&gt; 搜索 <code>git.auth</code>，取消勾选后重新勾选，然后重启终端。</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2025/08/21/%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93/spdlog%E7%9A%84%E4%BD%BF%E7%94%A8/">spdlog的使用</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2025-08-21</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/%E7%AC%AC%E4%B8%89%E6%96%B9%E5%BA%93/">第三方库</a></span><div class="content"><p>spdlog定义的日志级别最低为<code>TRACE</code>，最高为<code>FATAL</code>。当要发布程序时，把<code>SPDLOG_ACTIVE_LEVEL</code>宏的级别提高即可。</p>
<p>只有用<code>SPDLOG_LOGGER_宏</code>写日志，才能正常输出消息所在的文件、函数、行数。<code>SPDLOG_LOGGER_宏</code>本身支持format格式，比如 <code>SPDLOG_LOGGER_DEBUG(console, &quot;debug arg1=&#123;1&#125;, arg2=&#123;0&#125;&quot;, arg2, arg1)</code></p>
<p>代码中对spdlog进行了一次封装，即<code>quick_log.h</code>的类<code>QUICK_LOG</code>，使用时用<code>LOG_TRACE</code>, <code>LOG_INFO</code>等等，也可以用<code>TRACE</code>， <code>INFO</code>或者 <code>LOG_T</code>的形式</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2025/07/26/%E8%A1%8C%E4%B8%BA%E6%A0%91/StatefulActionNode/">异步动作 StatefulActionNode</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2025-07-26</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/%E8%A1%8C%E4%B8%BA%E6%A0%91/">行为树</a></span><div class="content"><p><strong>Asynchronous Action</strong> 即一个需要很长时间才能完成的动作，在完成标准未满足时会返回 RUNNING。</p>
<p>异步动作有以下要求：</p>
<ul>
<li>该方法 <code>tick()</code> 不应阻塞太久，执行流程应尽快返回。</li>
<li>如果调用 <code>halt()</code> 方法，应尽快中止。</li>
</ul>
<p>StatefulActionNode 是实现异步动作的首选方式。当你的代码包含请求-回复模式时，它特别有用，即动作向另一个进程发送异步请求，并定期检查回复是否已收到。根据那则回复，它可能会返回 SUCCESS 或 FAILURE。</p>
<p><code>StatefulActionNode</code> 的派生类必须重写以下虚拟方法，而不是 <code>tick()</code> ：</p>
<ul>
<li><p><code>NodeStatus onStart()</code> ：当节点处于 IDLE 状态时被调用。它可能会立即成功或失败，或者返回 RUNNING。在后一种情况下，下次收到 tick 时，方法 <code>onRunning</code> 将被执行。</p>
</li>
<li><p><code>NodeStatus onRunning()</code> : 当节点处于 RUNNING 状态时调用。返回新状态。</p>
</li>
<li><p><code>void onHalted()</code> : 当此节点被树中的另一个节点中止时调用。</p>
</li>
</ul>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2025/07/26/%E8%A1%8C%E4%B8%BA%E6%A0%91/%E8%A1%8C%E4%B8%BA%E6%A0%91%E7%9A%84%E9%BB%91%E6%9D%BF%E5%8F%98%E9%87%8F/">行为树的黑板变量</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2025-07-26</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/%E8%A1%8C%E4%B8%BA%E6%A0%91/">行为树</a></span><div class="content"><p>行为树中的共有数据是存放在Blackboard中的。Blackboard是以<code>键值对</code>的形式存储数据的。各个行为树的叶子节点均可以通过key访问到需要的数据。节点的输入端口可以从黑板读取数据，节点的输出端口可以写入黑板。</p>
<p>Ports是用于在节点间交换数据而存在的。一个行为树叶子节点可以定义输入的Ports和输出的Ports。<strong>当不同叶子节点的Port有相同的key名称时，可以认为它们是相通的。</strong>当在行为树叶子节点中声明了这些Ports时，也需要同时在xml文件中描述这些Ports。</p>
<p>注意设置子树的<code>__shared_blackboard</code>属性为true，否则C++程序可能报错</p>
<p>程序中如果加载了多个行为树，黑板变量可以共享。</p>
</div><hr></div><nav id="pagination"><div class="pagination"><span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/56/">56</a><a class="extend next" rel="next" href="/page/2/">Next &gt;&gt;</a></div></nav></div></div><footer class="footer-bg" style="background-image: url(https://s2.loli.net/2024/11/12/x1aqcwUG3XDiskN.jpg)"><div class="layout" id="footer"><div class="copyright">&copy;2018 - 2025 By Charon Cheung</div><div class="framework-info"><span>Driven - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_site_uv"><i class="fa fa-user"></i><span id="busuanzi_value_site_uv"></span><span></span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_site_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.6.1"></script><script src="/js/fancybox.js?version=1.6.1"></script><script src="/js/sidebar.js?version=1.6.1"></script><script src="/js/copy.js?version=1.6.1"></script><script src="/js/fireworks.js?version=1.6.1"></script><script src="/js/transition.js?version=1.6.1"></script><script src="/js/scroll.js?version=1.6.1"></script><script src="/js/head.js?version=1.6.1"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
    processEscapes: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
  },
  CommonHTML: {
    linebreaks: { automatic: true, width: "90% container" }
  },
  "HTML-CSS": { 
    linebreaks: { automatic: true, width: "90% container" }
  },
  "SVG": { 
    linebreaks: { automatic: true, width: "90% container" }
  }
});
</script><script type="text/x-mathjax-config">MathJax.Hub.Queue(function() {
  var all = MathJax.Hub.getAllJax(), i;
  for (i=0; i < all.length; i += 1) {
    all[i].SourceElement().parentNode.className += ' has-jax';
  }
});
</script><script src="https://cdn.bootcss.com/mathjax/2.7.2/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script>if(/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
}</script></body></html>