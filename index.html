<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"><meta name="description" content=""><meta name="keywords" content=""><meta name="author" content="Charon Cheung"><meta name="copyright" content="Charon Cheung"><title>If you wish for peace, prepare for war | 沉默杀手</title><link rel="shortcut icon" href="/melody-favicon.ico"><link rel="stylesheet" href="/css/index.css?version=1.6.1"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css?version=1.6.1"><link rel="dns-prefetch" href="https://cdn.staticfile.org"><link rel="dns-prefetch" href="https://cdn.bootcss.com"><link rel="dns-prefetch" href="https://creativecommons.org"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  }
} </script><meta name="generator" content="Hexo 5.4.0"></head><body><canvas class="fireworks"></canvas><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true"></i><div id="sidebar"><div class="author-info"><div class="author-info__avatar text-center"><img src="/img/avatar.png"></div><div class="author-info__name text-center">Charon Cheung</div><div class="author-info__description text-center"></div><hr><div class="author-info-articles"><a class="author-info-articles__archives article-meta" href="/archives"><span class="pull-left">Articles</span><span class="pull-right">483</span></a><a class="author-info-articles__tags article-meta" href="/tags"><span class="pull-left">Tags</span><span class="pull-right">5</span></a><a class="author-info-articles__categories article-meta" href="/categories"><span class="pull-left">Categories</span><span class="pull-right">44</span></a></div></div></div><nav id="nav" style="background-image: url(https://i.loli.net/2021/07/13/RCLw5Bx8aFPN74b.jpg)"><div id="page-header"><span class="pull-left"> <a id="site-name" href="/">沉默杀手</a></span><i class="fa fa-bars toggle-menu pull-right" aria-hidden="true"></i><span class="pull-right menus"><a class="site-page" href="/">Home</a><a class="site-page" href="/archives">Archives</a><a class="site-page" href="/tags">Tags</a><a class="site-page" href="/categories">Categories</a></span></div><div id="site-info"><div id="site-title">沉默杀手</div><div id="site-sub-title">If you wish for peace, prepare for war</div></div></nav><div id="content-outer"><div class="layout" id="content-inner"><div class="recent-post-item article-container"><a class="article-title" href="/2022/01/16/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92/%E5%BC%A0%E6%A5%ABDual-Stage%20Viewpoint%20Planner/%E5%89%8D%E5%90%91%E6%A8%A1%E6%8B%9F%E7%9A%84%E4%B8%89%E6%AC%A1%E6%A0%B7%E6%9D%A1%E6%9B%B2%E7%BA%BF/">前向模拟的三次样条曲线</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2022-01-16</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92/">路径规划</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92/Dual-Stage-Viewpoint-Planner/">Dual-Stage Viewpoint Planner</a></span><div class="content"><p><code>startPaths.ply</code>文件的文件头<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">ply</span><br><span class="line">format ascii 1.0</span><br><span class="line">element vertex 707  <span class="comment"># 点的总数</span></span><br><span class="line">property <span class="built_in">float</span> x</span><br><span class="line">property <span class="built_in">float</span> y</span><br><span class="line">property <span class="built_in">float</span> z</span><br><span class="line">property int group_id</span><br><span class="line">end_header</span><br></pre></td></tr></table></figure><br>然后是很多的点，形式是<code>0.842435 -0.113153 0.000000 2</code>，依次是x,y,z,索引。可以用<code>Cloud Compare</code>打开<br><img src="https://s2.loli.net/2021/12/28/kxCJTmw5UK4eF2L.png" alt="startPaths.ply"></p>
<p>同理还有两个文件<br><img src="https://s2.loli.net/2021/12/28/wr2PlsLRedabBE8.png" alt="paths.ply"><br><img src="https://s2.loli.net/2021/12/28/y9i6aOkroAfzseM.png" alt="pathList.ply"></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2022/01/12/SLAM%E5%B7%A5%E5%85%B7/Autoware%E5%AE%89%E8%A3%85/">Autoware安装</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2022-01-12</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/SLAM%E5%B7%A5%E5%85%B7/">SLAM工具</a></span><div class="content"><p>主要参考<a target="_blank" rel="noopener" href="https://blog.csdn.net/zhao5269/article/details/106827618">Ubuntu18.04下的源码安装和配置</a></p>
<p>需要先安装好 <code>ROS Melodic</code>, <code>Qt 5.12.0</code>(至少 5.9.5 版本), <code>OpenCV 4.0</code>（至少 3.0 版本），先不安装<br><code>CUDA 10.0</code></p>
<p>执行<code>sudo apt-get install ros-melodic-jsk-rviz-plugins</code>，避免一个报错</p>
<h2 id="安装-Autoware-1-14-0（至少1-12-0版本）"><a href="#安装-Autoware-1-14-0（至少1-12-0版本）" class="headerlink" title="安装 Autoware 1.14.0（至少1.12.0版本）"></a>安装 Autoware 1.14.0（至少1.12.0版本）</h2><p>先安装依赖项<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line"></span><br><span class="line">sudo apt install -y python-catkin-pkg python-rosdep ros-<span class="variable">$ROS_DISTRO</span>-catkin</span><br><span class="line"></span><br><span class="line">sudo apt install -y python3-pip python3-colcon-common-extensions python3-setuptools python3-vcstool</span><br><span class="line"></span><br><span class="line">pip3 install -U setuptools</span><br></pre></td></tr></table></figure></p>
<p>再下载源码和依赖项<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p autoware.ai/src</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> autoware.ai</span><br><span class="line"></span><br><span class="line">wget -O autoware.ai.repos <span class="string">&quot;https://raw.githubusercontent.com/Autoware-AI/autoware.ai/1.12.0/autoware.ai.repos&quot;</span></span><br><span class="line"></span><br><span class="line">vcs import src &lt; autoware.ai.repos</span><br><span class="line"></span><br><span class="line">rosdep update</span><br><span class="line">rosdep install -y --from-paths src --ignore-src --rosdistro <span class="variable">$ROS_DISTRO</span></span><br></pre></td></tr></table></figure><br>因为网络问题可能下载失败，不过我已经下载好了源码，直接解压到src即可，这样就不用第三和第四步了。<br>执行最后一步时可能又有几个依赖项下载失败，也已经下载好了，解压<code>festival等5个依赖性.zip</code>后，逐个安装deb文件即可。之后继续执行最后一步，还需要几分钟才完成。</p>
<p>安装编译工具<code>colcon</code>:  <code>sudo apt install python3-colcon-common-extensions</code></p>
<p>然后就开始编译了， 若已经配置好了 CUDA<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">AUTOWARE_COMPILE_WITH_CUDA=1 colcon build --cmake-args -DCMAKE_BUILD_TYPE=Release</span><br></pre></td></tr></table></figure><br>若没有CUDA支持，只使用 CPU：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">colcon build --cmake-args -DCMAKE_BUILD_TYPE=Release</span><br></pre></td></tr></table></figure></p>
<p>如果<code>opencv</code>使用的是ROS的3.2，可能会出现三个报错<br><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">error: ‘CV_WINDOW_AUTOSIZE’ <span class="function">was <span class="keyword">not</span> declared in <span class="keyword">this</span> scope</span></span><br><span class="line"><span class="function">          <span class="title">cv::namedWindow</span><span class="params">(<span class="string">&quot;CameraSimulator Color Viewer&quot;</span>,CV_WINDOW_AUTOSIZE)</span></span>;</span><br><span class="line">                                                         ^~~~~~~~~~~~~~~~~~</span><br><span class="line">/home/user/autoware.ai/src/autoware/utilities/kitti_player/src/kitti_player.cpp:<span class="number">879</span>:<span class="number">60</span>: note: suggested alternative: ‘CV_MINOR_VERSION’</span><br><span class="line"></span><br><span class="line"><span class="comment">// 解决方法： 改为 1</span></span><br><span class="line"></span><br><span class="line">/home/user/autoware.ai/src/autoware/utilities/kitti_player/src/kitti_player.cpp:<span class="number">889</span>:<span class="number">60</span>: error: ‘CV_LOAD_IMAGE_UNCHANGED’ was <span class="keyword">not</span> declared in <span class="keyword">this</span> scope</span><br><span class="line">          cv_image00 = cv::<span class="built_in">imread</span>(full_filename_image00, CV_LOAD_IMAGE_UNCHANGED);</span><br><span class="line">这是由于opencv高版本弃用  CV_LOAD_IMAGE_UNCHANGED  这一参数导致的</span><br><span class="line"></span><br><span class="line"><span class="comment">// 解决方法： 改为 -1</span></span><br><span class="line"></span><br><span class="line">/home/user/autoware.ai/src/autoware/utilities/kitti_player/src/kitti_player.cpp:<span class="number">986</span>:<span class="number">60</span>: error: ‘  CV_LOAD_IMAGE_GRAYSCALE  ’ was <span class="keyword">not</span> declared in <span class="keyword">this</span> scope</span><br><span class="line">          cv_image04 = cv::<span class="built_in">imread</span>(full_filename_image04, CV_LOAD_IMAGE_GRAYSCALE);</span><br><span class="line"><span class="comment">// 解决方法： 改为 0</span></span><br></pre></td></tr></table></figure></p>
<p>继续编译会又有错误：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">fatal error: opencv2/contrib/contrib.hpp: No such file or directory</span><br><span class="line">   <span class="comment">#include &lt;opencv2/contrib/contrib.hpp&gt;</span></span><br><span class="line"></span><br><span class="line">cmake -DOPENCV_EXTRA_MODULES_PATH=/home/user/autoware/opencv_contrib-4.x/modules &lt;opencv_source_directory&gt;</span><br></pre></td></tr></table></figure><br>这又是opencv的问题，所以最好还是安装opencv4.0</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2022/01/12/SLAM%E5%B7%A5%E5%85%B7/OpenCV%E7%9A%84%E5%AE%89%E8%A3%85%E5%92%8C%E5%A4%9A%E7%89%88%E6%9C%AC%E5%88%87%E6%8D%A2/">OpenCV的安装和多版本切换</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2022-01-12</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/SLAM%E5%B7%A5%E5%85%B7/">SLAM工具</a></span><div class="content"><ol>
<li><p>从OpenCV的github release下载，然后解压</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> opencv-4.2.0</span><br><span class="line">mkdir build  </span><br><span class="line"><span class="built_in">cd</span> build  </span><br><span class="line">cmake -D CMAKE_BUILD_TYPE=RELEASE -D CMAKE_INSTALL_PREFIX=/usr/<span class="built_in">local</span> ..  </span><br><span class="line">make</span><br><span class="line">sudo make install </span><br></pre></td></tr></table></figure>
<p>添加路径库 <code>sudo vim /etc/ld.so.conf.d/opencv.conf</code>，打开了一个新文档，在里面写入<code>/usr/local/lib</code> </p>
</li>
<li><p>配置环境变量<code>sudo vim /etc/profile</code>，在后面添加以下内容</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">PKG_CONFIG_PATH=<span class="variable">$PKG_CONFIG_PATH</span>:/usr/<span class="built_in">local</span>/lib/pkgconfig  </span><br><span class="line"><span class="built_in">export</span> PKG_CONFIG_PATH  </span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>3.测试<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~</span><br><span class="line"><span class="comment"># opencv的源码目录</span></span><br><span class="line"><span class="built_in">cd</span> opencv/samples/cpp/example_cmake</span><br><span class="line">cmake .</span><br><span class="line">make</span><br><span class="line">./opencv_example</span><br></pre></td></tr></table></figure><br>如果弹出一个视频窗口，有文字hello,opencv，代表安装成功</p>
<ol>
<li>检查是否有多个OpenCV版本<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">locate libopencv_video.so</span><br><span class="line"></span><br><span class="line">/usr/lib/x86_64-linux-gnu/libopencv_video.so</span><br><span class="line">/usr/lib/x86_64-linux-gnu/libopencv_video.so.3.2</span><br><span class="line">/usr/lib/x86_64-linux-gnu/libopencv_video.so.3.2.0</span><br><span class="line"></span><br><span class="line">/usr/<span class="built_in">local</span>/lib/libopencv_video.so</span><br><span class="line">/usr/<span class="built_in">local</span>/lib/libopencv_video.so.4.2</span><br><span class="line">/usr/<span class="built_in">local</span>/lib/libopencv_video.so.4.2.0</span><br></pre></td></tr></table></figure>
</li>
</ol>
<ol>
<li>如果你需要在Python3环境下使用OpenCV，那么<code>sudo pip3 install opencv-python</code>，python后不用加3。对于在Python环境中使用,比如说查看版本<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">cyp@cyp:~$  python</span><br><span class="line">Python 3.6.7 (default, Oct 22 2018, 11:32:17) </span><br><span class="line">[GCC 8.2.0] on linux</span><br><span class="line">Type <span class="string">&quot;help&quot;</span>, <span class="string">&quot;copyright&quot;</span>, <span class="string">&quot;credits&quot;</span> or <span class="string">&quot;license&quot;</span> <span class="keyword">for</span> more information.</span><br><span class="line">&gt;&gt;&gt; import cv2 as cv</span><br><span class="line">&gt;&gt;&gt; cv.__version__</span><br><span class="line"><span class="string">&#x27;4.1.0&#x27;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<p>在使用g++编译使用opencv的C++程序时，使用 <code>g++ &lt;cpp_code&gt; pkg-config opencv --libs --cflags opencv</code> 也可以使用cmake编译</p>
<ol>
<li>使用指定的版本</li>
</ol>
<p>在opencv编译好后，所在目录中一般会有一个叫OpenCVConfig.cmake的文件，这个文件中指定了CMake要去哪里找OpenCV，其.h文件在哪里等，比如其中一行：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Provide the include directories to the caller </span></span><br><span class="line"><span class="built_in">set</span>(OpenCV_INCLUDE_DIRS <span class="string">&quot;/home/ubuntu/src/opencv-3.1.0/build&quot;</span> <span class="string">&quot;/home/ubuntu/src/opencv-3.1.0/include&quot;</span> <span class="string">&quot;/home/ubuntu/src/opencv-3.1.0/include/opencv&quot;</span>) </span><br></pre></td></tr></table></figure><br>只要让CMake找到这个文件，这个文件就指定了Opencv的所有路径，因此设置OpenCV_DIR为包含OpenCVConfig.cmake的目录，如在C++工程CMakeLists.txt中添加:<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">set</span>(OpenCV_DIR <span class="string">&quot;/home/ubuntu/src/opencv-3.1.0/build&quot;</span>)</span><br></pre></td></tr></table></figure><br>因此，我们期望使用哪个版本的Opencv，只要找到对应的OpenCVConfig.cmake文件，并且将其路径添加到工程的CMakeLists.txt中即可了。</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/12/27/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92/%E5%BC%A0%E6%A5%ABDual-Stage%20Viewpoint%20Planner/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92%E6%A8%A1%E5%9D%97(%E4%BA%8C)%20pathFollower/">路径规划模块(二) pathFollower</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-12-27</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92/">路径规划</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92/Dual-Stage-Viewpoint-Planner/">Dual-Stage Viewpoint Planner</a></span><div class="content"><h2 id="话题"><a href="#话题" class="headerlink" title="话题"></a>话题</h2><p><code>joy</code>话题类型是<code>sensor_msgs/Joy</code>，发布者<code>rvizGA</code>，订阅者有:</p>
<ul>
<li>pathFollower</li>
<li>terrainAnalysisExt</li>
<li>localPlanner</li>
<li>terrainAnalysis</li>
</ul>
<p>Rviz上发布<code>waypoint</code>后，得到的<code>joy</code>消息，而且每次是相同的：<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">header:</span><br><span class="line">  seq: 0</span><br><span class="line">  stamp:</span><br><span class="line">    secs: 1640595487</span><br><span class="line">    nsecs: 707291876</span><br><span class="line">  frame_id: <span class="string">&quot;waypoint_tool&quot;</span></span><br><span class="line">axes: [0.0, 0.0, -1.0, 0.0, 1.0, 1.0, 0.0, 0.0]</span><br><span class="line">buttons: [0, 0, 0, 0, 0, 0, 0, 1, 0, 0, 0]</span><br></pre></td></tr></table></figure></p>
<p>查看<code>joystickHandler</code>函数，发现<code>joySpeed</code> 和 <code>joySpeedRaw</code> 都会被赋值为 1</p>
<p>话题<code>speed</code>也没有发布者，提供给用户，类型<code>std_msgs::Float32</code>，订阅者是<code>pathFollower</code>和<code>localPlanner</code>，目前看不出使用的必要。  </p>
<p>话题<code>stop</code>提供给用户，用于停止车的行走，类型<code>std_msgs::Int8</code></p>
<p><code>vehicleSpeed</code>逐步增加，也就是说输出速度是逐渐增加的</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/12/19/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92/%E5%BC%A0%E6%A5%ABDual-Stage%20Viewpoint%20Planner/local%20planner%E6%89%80%E7%94%A8%E5%8F%82%E6%95%B0/">local planner所用参数</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-12-19</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92/">路径规划</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92/Dual-Stage-Viewpoint-Planner/">Dual-Stage Viewpoint Planner</a></span><div class="content"><h2 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h2><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line">string pathFolder;     <span class="comment">//  使用matlab生成路径集合的文件路径</span></span><br><span class="line"><span class="keyword">double</span> vehicleLength = <span class="number">0.9</span>;        <span class="comment">//  车辆的长度，单位m</span></span><br><span class="line"><span class="keyword">double</span> vehicleWidth = <span class="number">0.6</span>;         <span class="comment">//  车辆的宽度，单位m</span></span><br><span class="line"><span class="keyword">double</span> sensorOffsetX = <span class="number">0</span>;          <span class="comment">//  传感器坐标系与车体中心的偏移量</span></span><br><span class="line"><span class="keyword">double</span> sensorOffsetY = <span class="number">0</span>;          <span class="comment">//  传感器坐标系与车体中心的偏移量</span></span><br><span class="line"><span class="keyword">bool</span> twoWayDrive = <span class="literal">true</span>;           <span class="comment">//  双向驱动</span></span><br><span class="line"><span class="keyword">double</span> laserVoxelSize = <span class="number">0.05</span>;      <span class="comment">//  下采样体素栅格叶大小</span></span><br><span class="line"><span class="keyword">double</span> terrainVoxelSize = <span class="number">0.2</span>;     <span class="comment">//  下采样体素栅格叶大小</span></span><br><span class="line"><span class="keyword">bool</span> useTerrainAnalysis = <span class="literal">false</span>;   <span class="comment">//  是否使用地面分割后的点云信息</span></span><br><span class="line"><span class="keyword">bool</span> checkObstacle = <span class="literal">true</span>;          </span><br><span class="line"><span class="keyword">bool</span> checkRotObstacle = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">double</span> adjacentRange = <span class="number">3.5</span>;        <span class="comment">//  裁剪点云时的距离</span></span><br><span class="line"><span class="keyword">double</span> obstacleHeightThre = <span class="number">0.2</span>;   <span class="comment">//  障碍物高度阈值</span></span><br><span class="line"><span class="keyword">double</span> groundHeightThre = <span class="number">0.1</span>;     <span class="comment">//  地面高度阈值</span></span><br><span class="line"><span class="keyword">double</span> costHeightThre = <span class="number">0.1</span>;       <span class="comment">//  计算路径惩罚得分的权重</span></span><br><span class="line"><span class="keyword">double</span> costScore = <span class="number">0.02</span>;           <span class="comment">//  最小惩罚得分</span></span><br><span class="line"><span class="keyword">bool</span> useCost = <span class="literal">false</span>;   </span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> laserCloudStackNum = <span class="number">1</span>;   <span class="comment">// 缓存的激光点云帧数量</span></span><br><span class="line"><span class="keyword">int</span> laserCloudCount = <span class="number">0</span>;            <span class="comment">// 当laserCloudStackNum = 1时,暂时没用到</span></span><br><span class="line"><span class="keyword">int</span> pointPerPathThre = <span class="number">2</span>;     <span class="comment">// 每条路径需要有几个被遮挡的点</span></span><br><span class="line"><span class="keyword">double</span> minRelZ = - <span class="number">0.5</span>;        <span class="comment">// 未使用地面分割时，裁剪点云时的最小高度</span></span><br><span class="line"><span class="keyword">double</span> maxRelZ = <span class="number">0.25</span>;      <span class="comment">// 未使用地面分割时，裁剪点云时的最大高度</span></span><br><span class="line"><span class="keyword">double</span> maxSpeed = <span class="number">1.0</span>;      <span class="comment">// 最大速度</span></span><br><span class="line"><span class="keyword">double</span> dirWeight = <span class="number">0.02</span>;    <span class="comment">// 计算得分时转向角度的权重</span></span><br><span class="line"><span class="keyword">double</span> dirThre = <span class="number">90.0</span>;              <span class="comment">// 最大转向角度</span></span><br><span class="line"><span class="keyword">bool</span> dirToVehicle = <span class="literal">false</span>;          <span class="comment">// 是否以车辆为主方向计算被遮挡的路径</span></span><br><span class="line"><span class="keyword">double</span> pathScale = <span class="number">1.0</span>;      <span class="comment">// 路径尺度</span></span><br><span class="line"><span class="keyword">double</span> minPathScale = <span class="number">0.75</span>;         <span class="comment">// 最小路径尺度</span></span><br><span class="line"><span class="keyword">double</span> pathScaleStep = <span class="number">0.25</span>;        <span class="comment">// 路径尺度的调整步长</span></span><br><span class="line"><span class="keyword">bool</span> pathScaleBySpeed = <span class="literal">true</span>;       <span class="comment">// 是否根据速度调整路径尺度</span></span><br><span class="line"><span class="keyword">double</span> minPathRange = <span class="number">1.0</span>;          <span class="comment">// 最小路径距离</span></span><br><span class="line"><span class="keyword">double</span> pathRangeStep = <span class="number">0.5</span>;         <span class="comment">// 路径范围的调整步长</span></span><br><span class="line"><span class="keyword">bool</span> pathRangeBySpeed = <span class="literal">true</span>;       <span class="comment">// 是否根据速度调整路径的范围</span></span><br><span class="line"><span class="keyword">bool</span> pathCropByGoal = <span class="literal">true</span>;         <span class="comment">// 是否根据目标点+ goalClearRange 筛选点云数据</span></span><br><span class="line"><span class="keyword">bool</span> autonomyMode = <span class="literal">false</span>;</span><br><span class="line"><span class="keyword">double</span> autonomySpeed = <span class="number">1.0</span>;</span><br><span class="line"><span class="keyword">double</span> goalClearRange = <span class="number">0.5</span>;        <span class="comment">// 当 pathCropByGoal = true 时,点云距离超过目标点+该值则不被处理</span></span><br><span class="line"><span class="keyword">double</span> goalX = <span class="number">0</span>;        <span class="comment">// 局部路径目标点</span></span><br><span class="line"><span class="keyword">double</span> goalY = <span class="number">0</span>;        <span class="comment">// 局部路径目标点</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">// 以下参数是在生成路径采样信息时设置,另一篇博客中介绍</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> pathNum = <span class="number">343</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> groupNum = <span class="number">7</span>;</span><br><span class="line"><span class="keyword">float</span> gridVoxelSize = <span class="number">0.02</span>;</span><br><span class="line"><span class="keyword">float</span> searchRadius = <span class="number">0.45</span>;</span><br><span class="line"><span class="keyword">float</span> gridVoxelOffsetX = <span class="number">3.2</span>;</span><br><span class="line"><span class="keyword">float</span> gridVoxelOffsetY = <span class="number">4.5</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> gridVoxelNumX = <span class="number">161</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> gridVoxelNumY = <span class="number">451</span>;</span><br><span class="line"><span class="keyword">const</span> <span class="keyword">int</span> gridVoxelNum = gridVoxelNumX * gridVoxelNumY;</span><br></pre></td></tr></table></figure>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/12/16/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92/%E5%BC%A0%E6%A5%ABDual-Stage%20Viewpoint%20Planner/terrain_analysis/">terrain_analysis</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-12-16</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92/">路径规划</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92/Dual-Stage-Viewpoint-Planner/">Dual-Stage Viewpoint Planner</a></span><div class="content">abstract Welcome to my blog, enter password to read.</div><a class="more" href="/2021/12/16/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92/%E5%BC%A0%E6%A5%ABDual-Stage%20Viewpoint%20Planner/terrain_analysis/#more">Read more</a><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/12/16/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92/%E5%BC%A0%E6%A5%ABDual-Stage%20Viewpoint%20Planner/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92%E6%A8%A1%E5%9D%97(%E4%B8%80)%20localPlanner/">路径规划模块(一) localPlanner</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-12-16</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92/">路径规划</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92/Dual-Stage-Viewpoint-Planner/">Dual-Stage Viewpoint Planner</a></span><div class="content"><p><code>local_planner.launch</code>包括节点<code>localPlanner</code>和<code>pathFollower</code>，以及发布<code>sensor ---&gt; vehicle</code> 和 <code>sensor ---&gt; camera</code>的tf变换</p>
<ul>
<li>避障: The collision avoidance is handled by the ‘local_planner’ package. The package computes collision-free paths to guide the vehicle through the environment. Motion primitives are pre-generated and loaded into the system upon start. When the vehicle navigates, the system in real-time determines the motion primitives occluded by obstacles. Those motion primitives are eliminated and the collision-free paths are selected. In the image below, the coordinate frame indicates the vehicle and the yellow dots are collision-free paths. In an autonomous navigation system, the collision avoidance module should be guided by a high-level planning module, e.g. a route planner that sends waypoints in the vicinity of the vehicle along the route. The collision avoidance module uses terrain maps from the ‘terrain_analysis’ package to determine terrain traversability (information below).</li>
</ul>
<p>Waypoint following: Upon receiving a waypoint, the system guides the vehicle to the waypoint. For information on tuning path following control, i.e. speed, yaw rate, acceleration, look-ahead distance, gains, and changing vehicle size, please refer to Ground-based Autonomy Base Repository.</p>
<p>Sending waypoints, navigation boundary, and speed: Upon receiving waypoint, navigation boundary, and speed messages, the system will navigate the vehicle inside the navigation boundary to the waypoint. Sending navigation boundary and speed is optional. The default speed in the system is set to 2m/s. Users can take the code in the ‘waypoint_example’ package as an example of sending these messages.</p>
<ul>
<li><p>Waypoint: 话题<code>way_point</code>，<code>geometry_msgs::PointStamped</code>类型的消息，在<code>map</code>坐标系。 发布者当然是<code>rvizGA</code> 和 <code>localPlanner</code> 和 <code>rvizGA</code></p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">header: </span><br><span class="line">  seq: 6</span><br><span class="line">  stamp: </span><br><span class="line">    secs: 215</span><br><span class="line">    nsecs: 380000000</span><br><span class="line">  frame_id: <span class="string">&quot;map&quot;</span></span><br><span class="line">point: </span><br><span class="line">  x: 9.90468215942</span><br><span class="line">  y: 12.2474937439</span><br><span class="line">  z: 0.839443683624</span><br><span class="line">---</span><br><span class="line">header: </span><br><span class="line">  seq: 7</span><br><span class="line">  stamp: </span><br><span class="line">    secs: 215</span><br><span class="line">    nsecs: 380000000</span><br><span class="line">  frame_id: <span class="string">&quot;map&quot;</span></span><br><span class="line">point: </span><br><span class="line">  x: 9.90468215942</span><br><span class="line">  y: 12.2474937439</span><br><span class="line">  z: 0.839443683624</span><br></pre></td></tr></table></figure>
</li>
<li><p>Navigation boundary (optional): 话题<code>navigation_boundary</code>，<code>geometry_msgs::PolygonStamped</code>的消息， 在<code>map</code>坐标系。 <strong>默认没有发布</strong>，订阅者是<code>localPlanner</code></p>
</li>
</ul>
<p><code>system_real_robot.launch</code>中的部分：<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">include</span> <span class="attr">file</span>=<span class="string">&quot;$(find local_planner)/launch/local_planner.launch&quot;</span> &gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;cameraOffsetZ&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$(arg cameraOffsetZ)&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;goalX&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$(arg vehicleX)&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">arg</span> <span class="attr">name</span>=<span class="string">&quot;goalY&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$(arg vehicleY)&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>这个launch其实就是localPlanner 和 pathFollower两个节点，再加两个tf转换<br><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;tf&quot;</span> <span class="attr">type</span>=<span class="string">&quot;static_transform_publisher&quot;</span> <span class="attr">name</span>=<span class="string">&quot;vehicleTransPublisher&quot;</span> <span class="attr">args</span>=<span class="string">&quot;-$(arg sensorOffsetX) -$(arg sensorOffsetY) 0 0 0 0 /sensor /vehicle 1000&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;tf&quot;</span> <span class="attr">type</span>=<span class="string">&quot;static_transform_publisher&quot;</span> <span class="attr">name</span>=<span class="string">&quot;sensorTransPublisher&quot;</span> <span class="attr">args</span>=<span class="string">&quot;0 0 $(arg cameraOffsetZ) -1.5707963 0 -1.5707963 /sensor /camera 1000&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure></p>
<p>节点<code>localPlanner</code>一直在发布话题<code>path</code>，为什么</p>
<p>只有path follower会发布cmd_vel消息，在机器人前往目标点的过程中，local planner会不断的对比机器人当前位置和目标点位置的差距，根据这个差值去控制机器人的直线速度和转向速度，最终不断逼近目标点。</p>
<h2 id="参数"><a href="#参数" class="headerlink" title="参数"></a>参数</h2><p>调整<code>local_planner.launch</code>中的参数<code>obstacleHeightThre</code> to account for terrain cloud thickness</p>
<p><img src="https://s2.loli.net/2021/12/11/7cKtkGTXH2vEs6f.png" alt=""></p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/12/16/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92/%E5%BC%A0%E6%A5%ABDual-Stage%20Viewpoint%20Planner/loam_interface%20%E5%92%8C%20sensor_scan_generation/">loam_interface 和 sensor_scan_generation</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-12-16</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92/">路径规划</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92/Dual-Stage-Viewpoint-Planner/">Dual-Stage Viewpoint Planner</a></span><div class="content"><p>不重要的是<code>ps3.launch</code>， <code>rviz</code>， 这里只列出重要部分</p>
<h2 id="loam-interface-launch"><a href="#loam-interface-launch" class="headerlink" title="loam_interface.launch"></a>loam_interface.launch</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">launch</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">node</span> <span class="attr">pkg</span>=<span class="string">&quot;loam_interface&quot;</span> <span class="attr">type</span>=<span class="string">&quot;loamInterface&quot;</span> <span class="attr">name</span>=<span class="string">&quot;loamInterface&quot;</span> <span class="attr">output</span>=<span class="string">&quot;screen&quot;</span> <span class="attr">required</span>=<span class="string">&quot;true&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;stateEstimationTopic&quot;</span> <span class="attr">type</span>=<span class="string">&quot;string&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/integrated_to_init&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;registeredScanTopic&quot;</span> <span class="attr">type</span>=<span class="string">&quot;string&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/velodyne_cloud_registered&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;flipStateEstimation&quot;</span> <span class="attr">type</span>=<span class="string">&quot;bool&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;flipRegisteredScan&quot;</span> <span class="attr">type</span>=<span class="string">&quot;bool&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;sendTF&quot;</span> <span class="attr">type</span>=<span class="string">&quot;bool&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;reverseTF&quot;</span> <span class="attr">type</span>=<span class="string">&quot;bool&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span> /&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">node</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">launch</span>&gt;</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>参数<code>stateEstimationTopic</code>换成世界坐标系下的机器人当前位姿，实际要求的是里程计消息，我的是从LOAM发布的<code>final_odom</code></p>
</li>
<li><p>参数<code>registeredScanTopic</code>为LOAM框架输出的关键帧话题，我的是Lego-LOAM的<code>current_scan</code></p>
</li>
<li><p>参数<code>flipStateEstimation</code> 和 <code>flipRegisteredScan</code>改为false，只要雷达位置没有旋转。否则启动后，机器人坐标系是旋转过的</p>
</li>
</ul>
<p>loam_interface的代码太简单了： 不断接收SLAM部分提供的世界坐标系下的机器人当前位姿 以及 世界坐标系下的当前关键帧，并分别以<code>state-estimastion</code>（换个名字和发布TF） 和 <code>registered_scan</code>(换个名字)话题名发布出去</p>
<h2 id="sensor-scan-generation-launch"><a href="#sensor-scan-generation-launch" class="headerlink" title="sensor_scan_generation.launch"></a>sensor_scan_generation.launch</h2><p>订阅<code>/state_estimation</code>和 <code>/registered_scan</code>，执行 <code>laserCloudAndOdometryHandler</code>，并发布<code>state_estimation_at_scan</code> 和 <code>sensor_scan</code></p>
<p>订阅<code>state_estimation</code>以及<code>registered_scan</code>，执行回调函数。</p>
<p>发布/state_estimation_at_scan（等同于/state_estimation）</p>
<p>发布/sensor_scan（世界坐标系下的点云转换至传感器Lidar坐标系下）</p>
</div><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/12/11/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92/%E5%BC%A0%E6%A5%ABDual-Stage%20Viewpoint%20Planner/TARE%E7%94%A8%E4%BA%8E%E7%9C%9F%E5%AE%9E%E6%9C%BA%E5%99%A8%E4%BA%BA/">TARE用于真实机器人</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-12-11</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92/">路径规划</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92/Dual-Stage-Viewpoint-Planner/">Dual-Stage Viewpoint Planner</a></span><div class="content">abstract Welcome to my blog, enter password to read.</div><a class="more" href="/2021/12/11/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92/%E5%BC%A0%E6%A5%ABDual-Stage%20Viewpoint%20Planner/TARE%E7%94%A8%E4%BA%8E%E7%9C%9F%E5%AE%9E%E6%9C%BA%E5%99%A8%E4%BA%BA/#more">Read more</a><hr></div><div class="recent-post-item article-container"><a class="article-title" href="/2021/12/11/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92/%E5%BC%A0%E6%A5%ABDual-Stage%20Viewpoint%20Planner/TARE%E5%9C%A8%E4%BB%BF%E7%9C%9F%E7%8E%AF%E5%A2%83/">TARE在仿真环境的运行</a><time class="post-meta__date"><i class="fa fa-calendar" aria-hidden="true"></i> 2021-12-11</time><span class="article-meta"><span class="article-meta__separator">|</span><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92/">路径规划</a><i class="fa fa-angle-right" aria-hidden="true"></i><i class="fa fa-inbox article-meta__icon" aria-hidden="true"></i><a class="article-meta__categories" href="/categories/%E8%B7%AF%E5%BE%84%E8%A7%84%E5%88%92/Dual-Stage-Viewpoint-Planner/">Dual-Stage Viewpoint Planner</a></span><div class="content"><p>搭建了五种仿真环境，室内环境/校园/停车场/隧道以及森林。</p>
<ul>
<li><p>校园环境(340m x 340m): 根据卡内基梅隆大学的部分校园环境重建得到，包含一些上下坡以及盘绕的地形。</p>
</li>
<li><p>室内环境(130m x 100m): 包含长且窄的走廊以及许多桌子/椅子等障碍物，其中还有一个护栏，由于其中间可以穿透的特性，会对机器人的感知（perception）模块增加挑战性。</p>
</li>
<li><p>停车场(140m x 130m, 5层): 包含多层楼且有上下坡，会对机器人3D导航任务增加难度</p>
</li>
<li><p>隧道(330m x 250m): 错综复杂的隧道构成的一个庞大的网格结构</p>
</li>
<li><p>森林(150m x 150m): 包含无规律分布的树木以及几栋房子。</p>
</li>
</ul>
<p>仿真平台暂时不支持车在崎岖路面上的行驶的动态模拟（车轮和路面的接触之类的）。</p>
<font color= blue, size=5> 仿真环境的制作</font>： 如果不需要用地图渲染rgb图像的话，把纯激光雷达点云地图导入`Cloud Compare`进行downsample和计算每个点的normal。然后将其保存成文件（比如ply格式），再用`meshlab`打开并重建成mesh。最后用meshlab把它存成dae格式的文件就能被加载进gazebo了。

### Simulation Environments

进入`src/vehicle_simulator/launch`，运行不同环境的launch，比如
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">roslaunch vehicle_simulator system_garage.launch</span><br></pre></td></tr></table></figure>
还可以换成`system_indoor.launch`等等

使用**Waypoint** button in RVIZ 进行导航。为了在Gazebo观察, 设置launch文件中的`gazebo_gui = true` 

环境文件在`src/vehicle_simulator/meshes`. `preview`文件夹中的`pointcloud.ply`是地图的点云文件，可使用 CloudCompare and MeshLab 打开。

## 运行出现的问题

在虚拟机下运行gazebo，得到<font color = orange size=4> vmw_ioctl_command error Invalid argument</font>错误
解决方法是在终端下设置环境变量为0：`export SVGA_VGPU10=0`， 再加入环境变量

<br>

打开gazebo报错 [Err] <font color = orange size=4> [REST.cc:205] Error in REST request</font> 

<p>执行<code>sudo gedit ~/.ignition/fuel/config.yaml</code>， 然后将<code>url : https://api.ignitionfuel.org</code> 改为 <code>url: https://api.ignitionrobotics.org</code></p>
<p><br><br><img src="https://i.loli.net/2021/11/22/tVlSzcPmNK7vWZu.png" alt="打开gazebo_ros出错.png"></p>
<h2 id="vehicle-simulator-launch"><a href="#vehicle-simulator-launch" class="headerlink" title="vehicle_simulator.launch"></a>vehicle_simulator.launch</h2><p><code>vehicle_simulator.launch</code>除了Gazebo那堆东西外，还有一个<code>vehicleSimulator</code>节点，发布<code>map ---&gt; sensor</code>转换。 发布话题: </p>
<ul>
<li>gazebo/set_model_state [gazebo_msgs/ModelState]</li>
<li>registered_scan [sensor_msgs/PointCloud2]</li>
<li>state_estimation [nav_msgs/Odometry]</li>
<li>tf [tf2_msgs/TFMessage]</li>
</ul>
<p>订阅话题: </p>
<ul>
<li>cmd_vel (50Hz)， path following 模块，用于发速度命令</li>
<li>terrain_map [sensor_msgs/PointCloud2]</li>
<li>velodyne_points [sensor_msgs/PointCloud2]</li>
</ul>
<p>激光是基于Velodyne VLP-16进行模拟的，话题<code>registered_scan</code>，类型<code>sensor_msgs/PointCloud2</code>，频率5Hz，坐标系是<code>map</code>。 订阅者：</p>
<ul>
<li>terrainAnalysisExt</li>
<li>sensorScanGeneration</li>
<li>localPlanner</li>
<li>terrainAnalysis</li>
<li>visualizationTools</li>
</ul>
<p>话题<code>state_estimation</code>其实就是里程计，频率200Hz，从<code>map</code>坐标系到<code>sensor</code>坐标系。但<code>twist</code>部分一直都是0<br><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">header: </span><br><span class="line">  seq: <span class="number">51875</span></span><br><span class="line">  stamp: </span><br><span class="line">    secs: <span class="number">262</span></span><br><span class="line">    nsecs: <span class="number">430000000</span></span><br><span class="line">  frame_id: <span class="string">&quot;/map&quot;</span></span><br><span class="line">child_frame_id: <span class="string">&quot;/sensor&quot;</span></span><br><span class="line">pose: </span><br><span class="line">  pose: </span><br><span class="line">    position: </span><br><span class="line">      x: <span class="number">2.87540912628</span></span><br><span class="line">      y: <span class="number">0.187103256583</span></span><br><span class="line">      z: <span class="number">0.711781859398</span></span><br><span class="line">    orientation: </span><br><span class="line">      x: <span class="number">0.00766504419326</span></span><br><span class="line">      y: <span class="number">0.00128535269673</span></span><br><span class="line">      z: <span class="number">0.0567104408485</span></span><br><span class="line">      w: <span class="number">0.998360416315</span></span><br><span class="line">  covariance: [<span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>, <span class="number">0.0</span>]</span><br><span class="line"><span class="comment"># 省略twist</span></span><br></pre></td></tr></table></figure></p>
<p>Low-frequency state estimation (5Hz): ‘nav_msgs::Odometry’ typed messages on ROS topic ‘/state_estimation_at_scan’, synchronized with ‘/sensor_scan’ messages, from ‘map’ frame to ‘sensor_at_scan’ frame.</p>
<h2 id="sensor-scan-generation-launch"><a href="#sensor-scan-generation-launch" class="headerlink" title="sensor_scan_generation.launch"></a>sensor_scan_generation.launch</h2><p><code>sensor_scan_generation.launch</code>就是把这<code>state_estimation</code> 和 <code>registered_scan</code>这两个话题做ROS时间戳同步，将<code>map</code>坐标系的点云<code>state_estimation</code>转为<code>sensor_at_scan</code>坐标系的<code>sensor_scan</code> (5Hz)。发布二者的tf变化，但是转换的矩阵是左乘<code>transformToMap</code>，它来自里程计，没理解为什么。</p>
<h2 id="Visualization-Tools"><a href="#Visualization-Tools" class="headerlink" title="Visualization Tools"></a>Visualization Tools</h2><p>可视化工具，将探索过程中的三个实验指标曲线进行可视化，通过matplotlib绘图显示出来。 包括探索体积，探索路程，每次规划的计算时间.</p>
<p><code>visualization_tools.launch</code>包括<code>realTimePlot.py</code> 和 <code>visualizationTools.cpp</code>。 <code>realTimePlot.py</code>就是窗口程序<code>Figure 1</code>，后者就是节点<code>visualizationTools</code>：<br>Publications: </p>
<ul>
<li>explored_areas [sensor_msgs/PointCloud2]</li>
<li>explored_volume [std_msgs/Float32]</li>
<li>overall_map [sensor_msgs/PointCloud2]</li>
<li>time_duration [std_msgs/Float32]</li>
<li>trajectory [sensor_msgs/PointCloud2]</li>
<li>traveling_distance [std_msgs/Float32]</li>
</ul>
<p>Subscriptions: </p>
<ul>
<li>clock [rosgraph_msgs/Clock]</li>
<li>registered_scan [sensor_msgs/PointCloud2]</li>
<li>runtime [unknown type]</li>
<li>state_estimation [nav_msgs/Odometry]</li>
</ul>
<p>为了观察算法的能力。RVIZ的<code>Panels-&gt;Displays</code>可以选择’overallMap’, ‘exploredAreas’, and ‘trajectory’。对应overall map of the environment, explored areas, and vehicle trajectory</p>
<p>窗口<code>Figure 1</code>实时地观察 <code>explored volume</code>, <code>traveling distance</code>, and <code>algorithm runtime</code>。 如果要绘制runtime曲线, users need to send the numbers as messages on the ROS topic below.</p>
<p>Runtime: ‘std_msgs::Float32’ typed messages on ROS topic ‘/runtime’.</p>
<p>但是我运行程序时，这三个指标曲线都没出现。</p>
<p>运行的最后，recorded metrics保存在文件<code>src/vehicle_simulator/log</code>, 以及vehicle trajectory. Note that due to the heavy CPU load of Gazebo, the real-time factor is &lt; 1 - the simulated clock is slower than the real clock. Here, we refer to the simulated clock in recording time duration of the run since it is less affected by the clock speed on different computers. The best human practice results can be downloaded.</p>
<p><br></p>
<h2 id="dsvp-launch-的使用"><a href="#dsvp-launch-的使用" class="headerlink" title="dsvp_launch 的使用"></a>dsvp_launch 的使用</h2><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">sudo apt update</span><br><span class="line">sudo apt install ros-melodic-octomap-ros libgoogle-glog-dev libgflags-dev</span><br><span class="line"><span class="comment"># 取melodic分支</span></span><br><span class="line">git <span class="built_in">clone</span> https://github.com/HongbiaoZ/dsv_planner.git</span><br></pre></td></tr></table></figure>
<p>编译结束后，运行<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 车库仿真环境，可以换成其他的</span></span><br><span class="line">roslaunch vehicle_simulator system_garage.launch</span><br><span class="line">roslaunch dsvp_launch explore_garage.launch</span><br></pre></td></tr></table></figure></p>
<p>然后是<code>Matterport3D</code>环境的配置，先跳过：To run DSV Planner in a Matterport3D environment, follow instructions to setup the development environment to use the Matterport3D environment. Then, use the command lines below to launch the system and DSV Planner.<br><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">roslaunch vehicle_simulator system_matterport.launch</span><br><span class="line">roslaunch dsvp_launch explore_matterport.launch</span><br></pre></td></tr></table></figure></p>
</div><hr></div><nav id="pagination"><div class="pagination"><span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/49/">49</a><a class="extend next" rel="next" href="/page/2/">Next &gt;&gt;</a></div></nav></div></div><footer class="footer-bg" style="background-image: url(https://i.loli.net/2021/07/13/RCLw5Bx8aFPN74b.jpg)"><div class="layout" id="footer"><div class="copyright">&copy;2018 - 2022 By Charon Cheung</div><div class="framework-info"><span>Driven - </span><a target="_blank" rel="noopener" href="http://hexo.io"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme - </span><a target="_blank" rel="noopener" href="https://github.com/Molunerfinn/hexo-theme-melody"><span>Melody</span></a></div><div class="busuanzi"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><span id="busuanzi_container_site_uv"><i class="fa fa-user"></i><span id="busuanzi_value_site_uv"></span><span></span></span><span class="footer-separator">|</span><span id="busuanzi_container_site_pv"><i class="fa fa-eye"></i><span id="busuanzi_value_site_pv"></span><span></span></span></div></div></footer><i class="fa fa-arrow-up" id="go-up" aria-hidden="true"></i><script src="https://cdn.jsdelivr.net/npm/animejs@latest/anime.min.js"></script><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-animate@latest/velocity.min.js"></script><script src="https://cdn.jsdelivr.net/npm/velocity-ui-pack@latest/velocity.ui.min.js"></script><script src="/js/utils.js?version=1.6.1"></script><script src="/js/fancybox.js?version=1.6.1"></script><script src="/js/sidebar.js?version=1.6.1"></script><script src="/js/copy.js?version=1.6.1"></script><script src="/js/fireworks.js?version=1.6.1"></script><script src="/js/transition.js?version=1.6.1"></script><script src="/js/scroll.js?version=1.6.1"></script><script src="/js/head.js?version=1.6.1"></script><script type="text/x-mathjax-config">MathJax.Hub.Config({
  tex2jax: {
    inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
    processEscapes: true,
    skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
  },
  CommonHTML: {
    linebreaks: { automatic: true, width: "90% container" }
  },
  "HTML-CSS": { 
    linebreaks: { automatic: true, width: "90% container" }
  },
  "SVG": { 
    linebreaks: { automatic: true, width: "90% container" }
  }
});
</script><script type="text/x-mathjax-config">MathJax.Hub.Queue(function() {
  var all = MathJax.Hub.getAllJax(), i;
  for (i=0; i < all.length; i += 1) {
    all[i].SourceElement().parentNode.className += ' has-jax';
  }
});
</script><script src="https://cdn.bootcss.com/mathjax/2.7.2/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script><script>if(/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)) {
  $('#nav').addClass('is-mobile')
  $('footer').addClass('is-mobile')
}</script></body></html>